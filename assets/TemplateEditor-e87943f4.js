import{_ as re,t as de,u as ue,B as pe,k as fe,Q as ve,r as a,c as p,o as me,d as f,e as x,n as t,q as I,x as h,J as E,i as l,y as v,f as y,h as P,A as _e,R as he,z as ye,I as be,Z as ke,U as ge,p as Ee,m as Se}from"./index-cd88dffc.js";import{T as we}from"./TabContainer-a940cec8.js";const o=s=>(Ee("data-v-6fa63c06"),s=s(),Se(),s),Ce={class:"preview-template"},Te={class:"template-editor"},De=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Me=[De],xe=["contenteditable"],Pe=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Re=[Pe],Ve=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ne=[Ve],Le={key:0,class:"error-message"},Be=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),je=[Be],Oe=["contenteditable"],Ie=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Ae=[Ie],Ge=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Fe=[Ge],Ue={key:0,class:"error-message"},qe=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),ze=[qe],Je=["contenteditable"],He=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Ze=[He],$e=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Qe=[$e],Ke={class:"preview-container"},We=o(()=>t("h3",{class:"heading"}," Preview ",-1)),Xe=["innerHTML"],Ye={class:"buttons"},et=o(()=>t("div",{class:"message"}," Generating PDF... ",-1)),tt={__name:"TemplateEditor",props:{id:{type:String,default:null},contentMarkup:{type:String,default:""},contentStyles:{type:String,default:""},disabled:{type:Boolean,default:!1},data:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},enableGenerate:{type:Boolean,default:!0},templateType:{type:String,default:null}},emits:["contentMarkupChange","contentStylesChange","dataChange"],setup(s,{emit:S}){const n=s,w=de(),A=ue(),{notEmpty:R}=pe(),C=fe(),G=new ve,F=a("style"),V=p(()=>({contentMarkup:n.contentMarkup,contentStyles:n.contentStyles})),N=a(0),U=[{label:"Markup"},{label:"Styles"},{label:"Data"}];function q(e){N.value=e}const T=a("markupEditor"),L=a("stylesEditor"),D=a("sampleDataEditor"),r=a(!1),d=a(!1),u=a(!1),z=p(()=>{const e=[];return e.push("editor"),r.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),J=p(()=>{const e=[];return e.push("editor"),d.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),H=p(()=>{const e=[];return e.push("editor"),u.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")});function Z(){r.value=!0}async function $(){_.value=!1,await M().then(e=>{ae()}).catch(e=>{_.value=!0,m.value="Markup error",C.error("Error updating markup",e)}).finally(()=>{r.value=!1})}function Q(){d.value=!0}function K(){se(),d.value=!1}function W(){u.value=!0}async function X(){_.value=!1,await M().then(e=>{ne()}).catch(e=>{_.value=!0,m.value="Sample data error",C.error("Error updating sample data",e)}).finally(()=>{u.value=!1})}function Y(){r.value=!r.value}function ee(){d.value=!d.value}function te(){u.value=!u.value}function ae(){S("contentMarkupChange",T.value.innerText)}function se(){S("contentStylesChange",L.value.innerText)}function ne(){const e=D.value.innerText;R(e)&&S("dataChange",JSON.parse(e))}const B=p(()=>n.data),oe=p(()=>_.value?"preview-content error":"preview-content"),m=a(),_=a(!1);async function M(){return new Promise((e,i)=>{m.value=null;const c=D.value.innerText;R(c)?G.parseAndRender(T.value.innerText,JSON.parse(c)).then(g=>{m.value=g,e(g)}).catch(g=>{i(g)}):e()})}const b=a(!1),k=a(),j=a(),O=a();async function le(){k.value=null,b.value=!0,await A.downloadStream(n.templateType,n.id,B.value,{path:"pdf"}).then(e=>{const i=new Blob([e.data],{type:"application/pdf"}),c=window.URL.createObjectURL(i);j.value=c,O.value=`${n.templateType}_${n.id}.pdf`,k.value=c,ie()}).catch(e=>{C.error("Error generating template",e)}).finally(()=>{ce()})}function ie(){const e=Object.assign({},w.currentRoute.value),i={path:"/document_templates/:templateType/:id/pdf",name:"View Pdf",component:()=>ge(()=>import("./PdfViewer-8b6cf6b5.js"),["assets/PdfViewer-8b6cf6b5.js","assets/index-cd88dffc.js","assets/index-0eee7c74.css","assets/PdfViewer-16a6273b.css"]),props:{templatePdfData:k.value,downloadLink:j.value,downloadFile:O.value},meta:{parentRoute:{name:e.name},hidden:!0}};w.addRoute(i),w.push({name:"View Pdf",params:{templateType:n.templateType,id:n.id}})}function ce(){b.value=!1}return me(async()=>{await M()}),(e,i)=>(f(),x("div",Ce,[t("div",Te,[I(we,{"selected-tab":N.value,tabs:U,onTabChange:q},{"tab-0":h(()=>[t("div",{class:E(l(z))},[t("div",{class:"editor-button cancel",onClick:Y},Me),t("div",{ref_key:"markupEditor",ref:T,class:"editor-content",contenteditable:r.value},v(l(V).contentMarkup),9,xe),t("div",{class:"editor-button edit",onClick:Z},Re),t("div",{class:"editor-button confirm",onClick:$},Ne)],2),s.errorMessages.contentMarkup?(f(),x("div",Le,v(s.errorMessages.contentMarkup),1)):y("",!0)]),"tab-1":h(()=>[t("div",{class:E(l(J))},[t("div",{class:"editor-button cancel",onClick:ee},je),t("div",{ref_key:"stylesEditor",ref:L,class:"editor-content",contenteditable:d.value},v(l(V).contentStyles),9,Oe),t("div",{class:"editor-button edit",onClick:Q},Ae),t("div",{class:"editor-button confirm",onClick:K},Fe)],2),s.errorMessages.contentStyles?(f(),x("div",Ue,v(s.errorMessages.contentStyles),1)):y("",!0)]),"tab-2":h(()=>[t("div",{class:E(l(H))},[t("div",{class:"editor-button cancel",onClick:te},ze),t("div",{ref_key:"sampleDataEditor",ref:D,class:"editor-content",contenteditable:u.value},v(l(B)),9,Je),t("div",{class:"editor-button edit",onClick:W},Ze),t("div",{class:"editor-button confirm",onClick:X},Qe)],2)]),_:1},8,["selected-tab"])]),t("div",Ke,[We,t("div",{class:E(l(oe)),innerHTML:m.value},null,10,Xe),s.contentStyles?(f(),P(he(F.value),{key:0},{default:h(()=>[_e(v(s.contentStyles),1)]),_:1})):y("",!0),t("div",Ye,[s.enableGenerate?(f(),P(l(ye),{key:0,value:"Generate",icon:"fa-solid fa-file-export",onClick:le})):y("",!0)])]),I(l(ke),{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=c=>b.value=c),class:"generate-dialog",title:"Generating PDF",width:400,height:250},{body:h(()=>[k.value?y("",!0):(f(),P(l(be),{key:0})),et]),_:1},8,["modelValue"])]))}},nt=re(tt,[["__scopeId","data-v-6fa63c06"]]);export{nt as T};
