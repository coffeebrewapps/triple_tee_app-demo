import{x as te,_ as oe,q as Te,r as T,e as ie,o as s,c as o,k as V,t as f,F as J,y as Q,h as i,f as u,z as he,A as _e,n as Ie,a as ke,u as we,b as Ve,d as D,g as ee,l as U,m as Fe,s as S,N as G,D as L,v as se,i as Ee,I as Pe,p as Ae,j as De}from"./index-2931c377.js";import{u as ae}from"./input-b440b62b.js";import{u as Se}from"./errors-29306128.js";import{u as $e}from"./utils-71d9759b.js";const{greaterThanOrEqual:F,compareMoreThan:re}=te();function Ce(){const c=[{minIncome:"md",maxIncome:"md"},{maxPayableAmount:"md",rate:"md"},{taxTableId:"lg"}];function h(a){return a.id}function b(a){return a.description}function $(a){return[{key:"id",type:"text",label:"ID",listable:!0,viewable:!1,creatable:!1,updatable:!1,sortable:!0},{key:"minIncome",type:"number",label:"Minimum Income",listable:!0,viewable:!0,creatable:!0,updatable:!0,sortable:!0},{key:"maxIncome",type:"number",label:"Maximum Income",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"maxPayableAmount",type:"number",label:"Maximum Payable Amount",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"rate",type:"number",label:"Rate",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"taxTableId",type:"singleSelect",label:"Tax Table",reference:{label:b},defaultValue:()=>a,listable:!0,viewable:!0,creatable:!0,updatable:!1,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tax_tables",value:h,label:b}}]}return{fieldsLayout:c,recordValue:h,taxTableLabel:b,generateDataFields:$,validations:{create:{minIncome:[a=>F(a,"minIncome",0)],maxIncome:[a=>F(a,"minIncome",0),a=>re(a,"maxIncome","minIncome")],maxPayableAmount:[a=>F(a,"maxPayableAmount",0)],rate:[a=>F(a,"rate",0)]},update:{minIncome:[a=>F(a,"minIncome",0)],maxIncome:[a=>F(a,"minIncome",0),a=>re(a,"maxIncome","minIncome")],maxPayableAmount:[a=>F(a,"maxPayableAmount",0)],rate:[a=>F(a,"rate",0)]}}}}const Ue={class:"view-container"},Le={class:"heading"},je={class:"details-container"},Me={class:"field-label"},Oe={key:0,class:"field-value"},ze={key:0},Ne={key:1},Be={key:1,class:"field-value"},Ke={key:0,class:"no-value"},Re={__name:"ViewPage",props:{heading:{type:String,default:null},fieldsLayout:{type:Array,default(){return[]}},dataFields:{type:Array,default(){return[]}},data:{type:Object,default(){return{}}}},setup(c){const h=c,{includeKeys:b,inputLabel:$,inputValue:C,tagsField:a}=ae(h.dataFields),{isEmpty:I,notEmpty:j}=te(),{formatTag:k,tagStyle:W}=_e(),M=Te().getSystemConfigs();async function O(){const p=[];h.dataFields.length>0?E.value=h.dataFields.reduce((v,g)=>{const y=g.key;return v[y]=h.data[y],a(y)&&p.push(w(h.data,y)),v},{}):E.value={},Promise.all(p).then(v=>{v.forEach(g=>{const y=`${g.key}Formatted`;E.value[y]=g.tags})})}const E=T({});async function w(p,v){const y=(p[v]||[]).map(d=>new Promise((x,r)=>{k(p,d,v,M.tagFormat).then(_=>{x(_)}).catch(_=>{r(_)})}));return new Promise((d,x)=>{Promise.all(y).then(r=>{d({key:v,tags:r})}).catch(r=>{x(r)})})}function Y(p,v){const g=`${p}Formatted`;return(E.value[g]||[])[v]}return ie(async()=>{await O()}),(p,v)=>(s(),o("div",Ue,[V("h2",Le,f(c.heading),1),V("div",je,[(s(!0),o(J,null,Q(c.fieldsLayout,(g,y)=>(s(),o("div",{key:y,class:"data-row"},[(s(!0),o(J,null,Q(Object.keys(g),(d,x)=>(s(),o("div",{key:x,class:"data-field"},[V("div",Me,f(i($)(d)),1),i(a)(d)?u("",!0):(s(),o("div",Oe,[i(j)(c.data)&&i(j)(c.data[d])?(s(),o("span",ze,f(i(C)(d,c.data,i(b),c.dataFields,i(M))),1)):u("",!0),i(I)(c.data)||i(I)(c.data[d])?(s(),o("span",Ne," --- no value --- ")):u("",!0)])),i(a)(d)?(s(),o("div",Be,[(s(!0),o(J,null,Q(c.data[d],(r,_)=>(s(),o("div",{key:_,class:"tag",style:he(i(W)(c.data,r,d))},f(Y(d,_)),5))),128)),c.data[d].length===0?(s(),o("div",Ke," --- no value --- ")):u("",!0)])):u("",!0)]))),128))]))),128))])]))}},He=oe(Re,[["__scopeId","data-v-28b2a536"]]);const ue=c=>(Ae("data-v-9f5b211b"),c=c(),De(),c),qe={class:"page-container"},Ge={class:"tax-table-actions"},Je={key:0,class:"error-message"},Qe=ue(()=>V("div",{class:"divider"},null,-1)),We={key:0},Xe={key:0},Ye={key:0},Ze={key:0},ea={key:0},aa={key:0},ta={class:"actions"},la=["onClick"],na={class:"tooltip"},sa=ue(()=>V("div",null,null,-1)),ra={__name:"ViewTaxTable",setup(c){const h=Ie(),b=ke(),{notEmpty:$}=te(),C=Se(),{flashMessage:a}=we(),I=Ve(),j=Object.assign({},h.currentRoute.value),k=D(()=>j.params.id),W=D(()=>w.value?`Tax Table: ${w.value.description}`:"Tax Table"),X=$e(),M=D(()=>X.fieldsLayout),O=D(()=>X.dataFields),E=ae(O.value),w=T();async function Y(){w.value=null;const e={include:E.includeKeys.value};await b.view("tax_tables",k.value,e).then(t=>{w.value=t,a("Loaded tax table successfully!")}).catch(t=>{I.error("Error loading tax table",t),a("Error loading tax table!")})}const p=Ce(),v=D(()=>{const e=p.generateDataFields(k.value),t=e.findIndex(n=>n.key==="taxTableId");e.splice(t,1);const l=e.findIndex(n=>n.key==="id");return e.splice(l,1),e}),g=p.validations.create,y=ae(v.value),d=y.updatableKeys,x=T([]),r=T([]),_=T(!1),P=T([]),z=T(),le=T(""),N=T(!1);async function B(){_.value=!0,x.value=[],r.value=[],P.value=[],await b.list("tax_tiers",{filters:{taxTableId:k.value},sort:{field:"minIncome",order:"asc"}}).then(e=>{x.value=e.data,r.value=e.data.map(t=>!1),P.value=r.value.map(t=>""),a("Loaded tax tiers successfully!")}).catch(e=>{I.error("Error loading tax tiers",e),a("Error loading tax tiers!")}).finally(()=>{_.value=!1})}const ce=[{name:"Add",icon:"fa-solid fa-circle-plus fa-xl",click:async function(e){await me()}}],de=[{name:"Edit",icon:"fa-solid fa-pencil",click:async function(e,t){r.value[t]=!0},show:function(e,t){return!r.value[t]}},{name:"Save",icon:"fa-solid fa-check",click:async function(e,t){await ye(e,t)},show:function(e,t){return r.value[t]}},{name:"Cancel",icon:"fa-solid fa-xmark",click:async function(e,t){r.value[t]=!1},show:function(e,t){return r.value[t]}},{name:"Delete",icon:"fa-solid fa-trash-can",click:async function(e,t){await xe(e,t)},show:function(e,t){return!0}}];async function me(){x.value.push({id:null,minIncome:null,maxIncome:null,maxPayableAmount:null,rate:null,taxTableId:k.value}),r.value.push(!0),P.value.push({})}function ve(e){const t=d.value.reduce((l,n)=>(l[n]=e[n],l),{});return y.formatDataForSave(t)}function K(e,t){return(P.value[e][t]||[]).map(n=>C[n.name](n.params)).join(", ")}async function ye(e,t){const l=ve(e);P.value[t]={};const n=y.validateParams(g,l);if(Object.keys(n).length>0){P.value[t]=n;return}e.id?await b.update("tax_tiers",e.id,Object.assign({},l,{taxTableId:k.value})).then(m=>{B(),r.value[t]=!1,a(`Saved tax tier ${e.id} successfully!`)}).catch(m=>{I.error(`Error saving tax tier ${e.id}`,m),a(`Error saving tax tier ${e.id}!`)}):await b.create("tax_tiers",Object.assign({},l,{taxTableId:k.value})).then(m=>{B(),r.value[t]=!1,a("Saved tax tier successfully!")}).catch(m=>{I.error("Error saving tax tier",m),a("Error saving tax tier!")})}async function xe(e,t){z.value=t,N.value=!0,le.value=`Are you sure you want to delete tier row ${t+1}?`}async function be(){const e=z.value,t=x.value[e];t.id?await b.remove("tax_tiers",t.id).then(l=>{B(),a("Deleted tax tier successfully!")}).catch(l=>{I.error("Error deleting tax tier",l),a("Error deleting tax tier!")}):x.value.splice(e,1),ne()}function ne(){N.value=!1,z.value=null}function fe(e){return(e*100).toFixed(2)}const A=T(),R=T();async function pe(){A.value=null,R.value=null,await b.view("tax_tables",k.value,{},{path:"estimate"}).then(e=>{A.value=e,a("Estimated tax successfully!")}).catch(e=>{R.value=Object.entries(e).map(([t,l])=>l.map(n=>`${t} ${C[n]()}`).join(`
`)).join(`
`),I.error("Error estimating tax",e),a("Error estimating tax!")})}function Z(e){return $(A.value)&&A.value.incomeBracket.id===e.id}const H=D(()=>x.value.map(e=>Z(e)?"row-field payable":"row-field"));return ie(async()=>{await Y(),await B()}),(e,t)=>(s(),o("div",qe,[w.value?(s(),ee(He,{key:0,heading:i(W),"fields-layout":i(M),"data-fields":i(O),data:w.value},null,8,["heading","fields-layout","data-fields","data"])):u("",!0),V("div",Ge,[U(i(Fe),{icon:"fa-solid fa-calculator",value:"Estimate Tax",onClick:pe}),R.value?(s(),o("div",Je," Estimate Tax Error: "+f(R.value),1)):u("",!0)]),Qe,w.value?(s(),ee(i(Ee),{key:1,name:"Tax Tiers",headers:i(v),data:x.value,"table-actions":ce,actions:de,loading:_.value,pagination:{offset:0,limit:x.value.length,client:!0}},{["data-col.minIncome"]:S(({row:l,i:n})=>[r.value[n]?(s(),o("div",We,[U(i(G),{modelValue:l.minIncome,"onUpdate:modelValue":m=>l.minIncome=m,type:"number",label:"",size:"md","error-message":K(n,"minIncome")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):u("",!0),r.value[n]?u("",!0):(s(),o("div",{key:1,class:L(i(H)[n])},f(l.minIncome.toFixed(2)),3))]),["data-col.maxIncome"]:S(({row:l,i:n})=>[r.value[n]?(s(),o("div",Xe,[U(i(G),{modelValue:l.maxIncome,"onUpdate:modelValue":m=>l.maxIncome=m,type:"number",label:"",size:"md","error-message":K(n,"maxIncome")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):u("",!0),r.value[n]?u("",!0):(s(),o("div",{key:1,class:L(i(H)[n])},[se(f(l.maxIncome.toFixed(2))+" ",1),Z(l)?(s(),o("span",Ye," (Nett Income: "+f(A.value.nettIncome.toFixed(2))+") ",1)):u("",!0)],2))]),["data-col.maxPayableAmount"]:S(({row:l,i:n})=>[r.value[n]?(s(),o("div",Ze,[U(i(G),{modelValue:l.maxPayableAmount,"onUpdate:modelValue":m=>l.maxPayableAmount=m,type:"number",label:"",size:"md","error-message":K(n,"maxPayableAmount")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):u("",!0),r.value[n]?u("",!0):(s(),o("div",{key:1,class:L(i(H)[n])},[se(f(l.maxPayableAmount.toFixed(2))+" ",1),Z(l)?(s(),o("span",ea," (Payable: "+f(A.value.payable.toFixed(2))+") ",1)):u("",!0)],2))]),["data-col.rate"]:S(({row:l,i:n})=>[r.value[n]?(s(),o("div",aa,[U(i(G),{modelValue:l.rate,"onUpdate:modelValue":m=>l.rate=m,type:"number",label:"",size:"md","error-message":K(n,"rate")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):u("",!0),r.value[n]?u("",!0):(s(),o("div",{key:1,class:L(i(H)[n])},f(fe(l.rate))+"% ",3))]),"data-actions":S(({row:l,actions:n,i:m})=>[V("div",ta,[(s(!0),o(J,null,Q(n,(q,ge)=>(s(),o("div",{key:ge},[q.show(l,m)?(s(),o("div",{key:0,class:"action tooltipable",onClick:oa=>q.click(l,m)},[V("i",{class:L(q.icon)},null,2),V("span",na,f(q.name),1)],8,la)):u("",!0)]))),128))])]),pagination:S(()=>[sa]),_:2},1032,["headers","data","loading","pagination"])):u("",!0),z.value?(s(),ee(i(Pe),{key:2,modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=l=>N.value=l),title:"Delete Tier","primary-text":le.value,"secondary-text":"",width:500,height:250,class:"delete-dialog",onConfirm:be,onCancel:ne},null,8,["modelValue","primary-text"])):u("",!0)]))}},ma=oe(ra,[["__scopeId","data-v-9f5b211b"]]);export{ma as default};
