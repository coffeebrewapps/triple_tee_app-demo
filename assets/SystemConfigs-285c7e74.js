import{D as j}from"./DataForm-3845a8de.js";import{_ as M,u as P,v as T,j as A,r as l,c,o as K,d as v,e as O,h as $,i as _,f as H}from"./index-e008ca9e.js";import{u as N}from"./input-7de6210c.js";import"./errors-ebd9927f.js";const R={class:"view-container"},Z={__name:"SystemConfigs",setup(q){const u=P(),C=T(),{flashMessage:r}=A(),s=l(),i=l({}),m=c(()=>n.value.filter(e=>e.updatable)),d=c(()=>m.value.map(e=>e.key)),h=[{tagFormat:"md",timezone:"lg"},{baseCurrencyId:"lg",baseContactId:"lg"}];function f(e){return e.id}function p(e){return`${e.code} (${e.symbol})`}function b(e){return e.name}const S=Intl.supportedValuesOf("timeZone").map(e=>{const a=e.replace(/_/g," ");return{value:e,label:a}}),n=l([{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"select",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0,options:S},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:f,label:p}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:b},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:f,label:b}}]),{formatDataForShow:k,formatDataForSave:w,formatErrorsForDisplay:F}=N(n.value);function D(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function I(e){const a=w(Object.assign({},e));await u.create("system_configs",a,{path:"replace"}).then(t=>{r("Updated config successfully!"),C.updateSystemConfigs(t),y(t).then(o=>{s.value=o})}).catch(t=>{console.error(t),i.value=F(t),r("Error updating config!")})}async function y(e){const a=d.value.map(t=>k(t,e));return new Promise((t,o)=>{Promise.all(a).then(z=>{const g={};m.value.forEach((E,L)=>{const U=E.key;g[U]=z[L]}),t(g)})})}async function B(){return new Promise((e,a)=>{u.list("system_configs",{},{path:"latest"}).then(t=>{const o=t.record;e(o)}).catch(t=>{a(t)})})}const x=c(()=>({type:"text",icon:"fa-solid fa-check",value:"Update"})),V=null;return K(async()=>{await B().then(e=>{e?y(e).then(a=>{s.value=a}):s.value=D()}).catch(e=>{console.error(e),r("Error loading config!")})}),(e,a)=>(v(),O("div",R,[s.value?(v(),$(j,{key:0,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value=t),"fields-layout":h,"data-fields":_(d),schemas:n.value,"error-messages":i.value,"confirm-button":_(x),"cancel-button":V,onSubmit:I},null,8,["modelValue","data-fields","schemas","error-messages","confirm-button"])):H("",!0)]))}},X=M(Z,[["__scopeId","data-v-c7617770"]]);export{X as default};
