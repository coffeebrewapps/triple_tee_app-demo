import{u as Oe,A as ge,j as de,c as i,D as Fe,a8 as je}from"./index-cb685be9.js";const w=Oe(),{formatDate:he,formatTimestamp:ke}=Fe(),{isEmpty:d,notEmpty:b}=ge(),{base64ToFile:q}=je(),D=de();function De(F){const u=i(()=>F.reduce((e,t)=>(e[t.key]=t,e),{})),V=i(()=>Object.values(u.value).filter(e=>e.listable)),B=i(()=>V.value.map(e=>e.key)),E=i(()=>Object.values(u.value).filter(e=>e.viewable)),G=i(()=>E.value.map(e=>e.key)),S=i(()=>Object.values(u.value).filter(e=>e.creatable)),Q=i(()=>S.value.map(e=>e.key)),T=i(()=>Object.values(u.value).filter(e=>e.updatable)),R=i(()=>T.value.map(e=>e.key)),P=i(()=>Object.values(u.value).filter(e=>e.sortable)),W=i(()=>P.value.map(e=>e.key)),X=i(()=>Object.values(u.value).some(e=>e.type==="file")),K=i(()=>Object.keys(u.value).filter(e=>M(e))),j=i(()=>Object.keys(u.value).filter(e=>z(e))),Y=i(()=>Object.keys(u.value).filter(e=>h(e))),A=i(()=>Object.keys(u.value).filter(e=>v(e))),I=i(()=>Object.keys(u.value).filter(e=>y(e))),Z=i(()=>Object.keys(u.value).filter(e=>J(e))),_=i(()=>Object.keys(u.value).filter(e=>L(e))),x=i(()=>Object.keys(u.value).filter(e=>k(e))),C=i(()=>Object.keys(u.value).filter(e=>N(e))),$=i(()=>Object.keys(u.value).filter(e=>O(e))),ee=i(()=>F.filter(e=>e.reference||e.file)),te=i(()=>ee.value.map(e=>e.key));function m(e){return(u.value[e]||{}).type}function ne(e){return(u.value[e]||{}).label}function ae(e,t,a,n,r){const o=a.find(s=>s===e),l=t[e];if(!d(l))if(b(o)&&!O(e)){const s=t.includes||{},f=[l].flat().filter(p=>!!p).map(p=>{const g=s[e][p];return u.value[e].reference.label(g)});return v(e)?f:f[0]}else return m(e)==="enum"||m(e)==="select"?n.find(f=>f.key===e).options.find(f=>f.value===l).label:m(e)==="datetime"?ke(l,r.timezone):m(e)==="date"?he(l,r.timezone):O(e)?((t.includes||{})[e][l]||{}).rawData:l}function re(e){return m(e)==="text"||m(e)==="number"}function se(e){return m(e)==="textarea"}function v(e){return m(e)==="multiSelect"}function y(e){return m(e)==="singleSelect"}function M(e){return m(e)==="select"||m(e)==="enum"}function h(e){return m(e)==="select"||m(e)==="multiSelect"||m(e)==="singleSelect"||m(e)==="enum"}function z(e){return h(e)&&u.value[e].options&&u.value[e].options.server}function J(e){return u.value[e].nullToggleable}function L(e){return e==="tags"||Object.is(u.value[e].isTags,!0)}function k(e){return m(e)==="object"}function N(e){return m(e)==="number"}function O(e){return m(e)==="file"}function H(e,t,a,n){return Object.assign({},{loading:!1,pagination:{offset:t,limit:a,client:!1}},n)}function ue(e){return F.map(t=>{if(t.type==="enum"){const a=e[t.key].enums,n=Object.keys(a).map(o=>({value:o,label:a[o]}));return Object.assign({},t,{options:n})}else return t})}function le(e,t){return Object.keys(e).reduce((a,n)=>{const o=e[n].map(l=>l(t)).filter(l=>!!l);return o.length>0&&(a[n]=o),a},{})}async function oe(e,t){return w.view(e,t,{})}async function ce(e,t){const a=u.value[e].options,n=a.modelClass,r=t.map(o=>oe(n,o));return new Promise((o,l)=>{Promise.all(r).then(s=>{const c=s.map(f=>{const p=a.value(f),g=a.label(f);return{value:p,label:g}});o(c)}).catch(s=>{D.error("Error loading includes from server",s),l(s)})})}function ie(e,t){const a=t[e];if(b(a))return a;const n=u.value[e].defaultValue;return b(n)?n():a}async function me(e,t){return new Promise((a,n)=>{const r=ie(e,t);if(d(r)){a(r);return}if(k(e)){b(r)?a(JSON.stringify(r,!1,4)):a(r);return}if(O(e)){const l=u.value[e].file;if(b(t.includes)&&b(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];q(s.rawData,s.filename,s.mimeType).then(c=>{a(c)}).catch(c=>{n(c)})}else w.view(l.modelClass,r,{}).then(s=>{d(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,q(s.rawData,s.filename,s.mimeType).then(c=>{a(c)}).catch(c=>{n(c)})}).catch(s=>{D.error("Error formatting data for show",s),a(r)});return}if(m(e)!=="date"&&m(e)!=="datetime"&&!v(e)&&!y(e)){a(r);return}if(m(e)==="date"||m(e)==="datetime"){let l;r instanceof Date||typeof r=="string"?l=new Date(r):l=Object.entries(r).reduce((s,[c,f])=>(b(f)?s[c]=new Date(f):s[c]=f,s),{}),a(l);return}const o=[r].flat();if((y(e)||v(e))&&Array.isArray(u.value[e].options)){const l=u.value[e].options,s=o.map(c=>{const f=l.find(p=>p.value===c);return{value:f.value,label:f.label}});a(s);return}if(b(t.includes)&&b(t.includes[e])&&Object.keys(t.includes[e]).length>0){const l=t.includes[e],s=o.map(c=>{const f=l[c],p=u.value[e].options,g=p.value(f),ye=p.label(f);return{value:g,label:ye}});a(s)}else ce(e,o).then(l=>{a(l)}).catch(l=>{D.error("Error formatting data for show",l);const s=[];o.forEach(c=>{b(c)&&s.push({value:c,label:c})}),a(s)})})}function fe(e){const t=Object.assign({},e);return A.value.forEach(n=>{const r=t[n]||[];t[n]=r.map(o=>o.value)}),I.value.forEach(n=>{const r=t[n]||[];t[n]=(r[0]||{}).value}),K.value.forEach(n=>{const r=t[n];(d(r)||r.length===0)&&(t[n]=null)}),x.value.forEach(n=>{b(t[n])&&t[n].length>0&&(t[n]=JSON.parse(t[n]))}),C.value.forEach(n=>{b(t[n])&&(t[n]=parseFloat(t[n]))}),Object.entries(t).reduce((n,[r,o])=>(Object.is(o,void 0)?n[r]=null:n[r]=o,n),{})}function pe(e){return Object.entries(e).reduce((t,[a,n])=>(t[a]=n.map(r=>({name:r,params:{}})),t),{})}function be(e={}){return Object.entries(e).reduce((t,[a,n])=>(b(n)&&n!==""&&(y(a)&&n.length>0?t[a]=n[0].value:v(a)&&n.length>0?t[a]=n.map(r=>r.value):t[a]=n),t),{})}async function U(e,t){const a=u.value[e].options||{};if(a.server){const n=a.limit||5;return new Promise((r,o)=>{w.list(a.modelClass,{offset:t,limit:n}).then(l=>{const s=l.data,f={total:l.total,data:s.map(p=>({value:a.value(p),label:a.label(p)}))};r(H(e,t,n,f))})})}else return new Promise((n,r)=>{n(Object.assign({},{data:a,total:a.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ve(){return new Promise((e,t)=>{Promise.all(j.value.map(a=>{const n=u.value[a].offset||0;return U(a,n)})).then(a=>{const n={};a.forEach((r,o)=>{const l=j.value[o];n[l]=r}),e(n)}).catch(a=>{t(a)})})}return{schemasMap:u,listableFields:V,listableKeys:B,viewableFields:E,viewableKeys:G,creatableFields:S,creatableKeys:Q,updatableFields:T,updatableKeys:R,sortableFields:P,sortableKeys:W,multipartData:X,clientOptionsFields:K,clientOptionsField:M,serverOptionsFields:j,serverOptionsField:z,selectableKeys:Y,multiSelectableFields:A,singleSelectableFields:I,inputType:m,inputLabel:ne,inputValue:ae,inputableField:re,multiInputableField:se,multiSelectableField:v,singleSelectableField:y,selectableField:h,nullToggleableField:J,nullToggleableFields:Z,tagsField:L,tagsFields:_,objectField:k,objectFields:x,numberField:N,numberFields:C,fileField:O,fileFields:$,includeKeys:te,formatInputOptionsData:H,formatDataFields:ue,formatDataForShow:me,formatDataForSave:fe,formatErrorsForDisplay:pe,formatFilters:be,validateParams:le,fetchOptions:U,initOptionsData:ve}}export{De as u};
