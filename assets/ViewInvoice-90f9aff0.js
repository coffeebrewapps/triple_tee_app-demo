import{u as G}from"./input-0aa0a466.js";import{y as P,c as j,b as a,g as m,s as g,v as q,l as f,t as _,h as n,_ as J,u as Q,C as R,j as W,q as X,a as Y,r as v,o as Z,d as l,D as ee,e as u,F as A,f as H}from"./index-c1560e4c.js";import{u as te}from"./utils-1c343f25.js";import{T as ae}from"./TabContainer-9436e036.js";import{D as ne}from"./DataPage-1ec31af8.js";import{T as ie}from"./TemplateEditor-365acaf2.js";import"./errors-ebd9927f.js";import"./DataForm-5b933c52.js";const le={__name:"InvoiceLines",props:{invoiceId:{type:String,default:null}},setup(I){const p=I,{greaterThanOrEqual:o}=P(),h=[{description:"lg"},{unit:"md",unitCost:"md",subtotal:"md"},{invoiceId:"lg"}],C=j(()=>[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"description",type:"text",label:"Description",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0},{key:"unit",type:"enum",label:"Unit",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"unitCost",type:"number",label:"Unit Cost",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"subtotal",type:"number",label:"Subtotal",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"invoiceId",type:"singleSelect",label:"Invoice",reference:{label:s},listable:!1,viewable:!0,creatable:!0,updatable:!1,filterable:!0,options:{server:!0,pagination:!0,modelClass:"invoices",value:D,label:s}}]);function D(e){return e.id}function s(e){return`Invoice #${e.invoiceNumber}`}const S={create:{unitCost:[e=>o(e,"unitCost",0)],subtotal:[e=>o(e,"subtotal",0)]},update:{unitCost:[e=>o(e,"unitCost",0)],subtotal:[e=>o(e,"subtotal",0)]}},k=j(()=>{const e={};return p.invoiceId&&(e.invoiceId=[{value:p.invoiceId}]),e.description=null,{initData:e,layout:[{invoiceId:"lg",description:"lg"}]}}),T={oneline:!0,showHeader:!1,highlightField:"description"};return(e,E)=>(a(),m(ne,{"model-class":"invoice_lines","data-type":"Invoice Lines","fields-layout":h,"data-fields":n(C),validations:S,filters:n(k),"table-style":T},{["data-col.unitCost"]:g(({row:b,formattedValue:x,inputValue:w})=>[q(" Charging "),f("strong",null,_(x),1),q(" per "),f("strong",null,_(w("unit",b)),1)]),["data-col.subtotal"]:g(({formattedValue:b})=>[q(" Subtotal "),f("strong",null,_(b.toFixed(2)),1)]),_:2},1032,["data-fields","filters"]))}};const oe={class:"page-container"},se={key:0,class:"details-container"},ce={class:"field-label"},ue={class:"field-value"},re={key:0},de={key:1},ve={__name:"ViewInvoice",props:{contactId:{type:String,default:null},invoiceId:{type:String,default:null}},setup(I){const p=I,o=Q(),{isEmpty:h,notEmpty:C}=P(),D=R(),{flashMessage:s}=W(),S=X(),k=Y(),{fieldsLayout:T,generateDataFields:e}=te(),E=j(()=>e(p.contactId)),{inputLabel:b,inputValue:x,includeKeys:w}=G(E.value),i=v(),V=v(),F=v(),r=v(),M=v();async function O(){i.value=null;const t={include:w.value};await o.view("invoices",p.invoiceId,t).then(d=>{i.value=d,s("Loaded invoice successfully!")}).catch(d=>{k.error("Error loading invoice",d),s("Error loading invoice!")})}async function $(){V.value=null,F.value=null,r.value=null,o.view("invoices",i.value.id,{},{path:"template_data"}).then(t=>{V.value=t.invoiceLines,F.value=t.invoiceConfig,r.value=t.invoiceTemplate;const d=t.invoiceNumberSequence,N=t.currency,B=t.billingContact,c=t.country,L=t.logo;M.value={invoice:i.value,invoiceLines:V.value,invoiceConfig:F.value,invoiceNumberSequence:d,billingContact:Object.assign({},B,{country:c.countryName,logo:L.rawData}),currency:N,country:c,logo:L},s("Loaded template data successfully!")}).catch(t=>{k.error("Error loading template data",t),s("Error loading template data!")})}const y=v(0),U=[{label:"Details",onchange:O},{label:"Invoice Lines",onchange:K},{label:"View Invoice PDF",onchange:$}];async function K(){D.emitEvent("loadData",{dataType:"Invoice Lines"})}async function z(t){await U[t].onchange(),y.value=t}return Z(async()=>{await O()}),(t,d)=>(a(),l("div",oe,[i.value?u("",!0):(a(),m(n(ee),{key:0})),i.value?(a(),m(ae,{key:1,"selected-tab":y.value,tabs:U,onTabChange:z},{"tab-0":g(()=>[y.value===0?(a(),l("div",se,[(a(!0),l(A,null,H(n(T),(N,B)=>(a(),l("div",{key:B,class:"data-row"},[(a(!0),l(A,null,H(Object.keys(N),(c,L)=>(a(),l("div",{key:L,class:"data-field"},[f("div",ce,_(n(b)(c)),1),f("div",ue,[n(C)(i.value)&&n(C)(i.value[c])?(a(),l("span",re,_(n(x)(c,i.value,n(w),n(E),n(S))),1)):u("",!0),n(h)(i.value)||n(h)(i.value[c])?(a(),l("span",de," --- no value --- ")):u("",!0)])]))),128))]))),128))])):u("",!0)]),"tab-1":g(()=>[y.value===1?(a(),m(le,{key:0,"invoice-id":I.invoiceId},null,8,["invoice-id"])):u("",!0)]),"tab-2":g(()=>[y.value===2&&r.value?(a(),m(ie,{key:0,id:r.value.id,"template-type":"invoice_templates","content-markup":r.value.contentMarkup,"content-styles":r.value.contentStyles,data:M.value,disabled:!0},null,8,["id","content-markup","content-styles","data"])):u("",!0)]),_:1},8,["selected-tab"])):u("",!0)]))}},he=J(ve,[["__scopeId","data-v-7c443302"]]);export{he as default};
