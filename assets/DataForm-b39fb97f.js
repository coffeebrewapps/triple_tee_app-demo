import{u as he}from"./input-2a619ab7.js";import{u as Ue}from"./errors-ebd9927f.js";import{_ as ke,B as Fe,k as De,r as O,c as x,o as ze,d as r,e as U,n as T,F as _,g as E,M as Oe,J as $,h as b,i as t,H as Te,f as m,a2 as Be,S as Ce,a3 as we,a4 as je,$ as Me,Y as I,a5 as Se,a6 as xe,a7 as L,q as B,a1 as _e,z as P,a8 as Ee}from"./index-61869e54.js";const $e={class:"body"},Ie={class:"field-input"},Le={key:0,class:"field-toggle"},Pe={key:0,class:"actions"},He={__name:"DataForm",props:{modelValue:{type:Object,default(){return{}}},fieldsLayout:{type:Array,default(){return[]}},dataFields:{type:Array,default(){return[]}},schemas:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},compact:{type:Boolean,default:!1},submittable:{type:Boolean,default:!0},confirmButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-check",value:"Confirm"}}},cancelButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-xmark",value:"Cancel"}}}},emits:["update:modelValue","submit","cancel"],setup(v,{emit:C}){const y=v,{schemasMap:k,serverOptionsKeys:H,inputType:c,inputLabel:u,inputableField:K,multiInputableField:N,multiSelectableField:A,singleSelectableField:R,nullToggleableField:F,nullToggleableKeys:q,objectField:J,fileKeys:Y,fileField:G,formatInputOptionsData:Q,fetchOptions:W,initOptionsData:X}=he(y.schemas),{notEmpty:w}=Fe(),j=De(),Z=Ue(),D=O(q.value.reduce((a,s)=>(a[s]=!1,a),{}));function i(a){return!F(a)||D.value[a]}function f(a){return i(a)&&K(a)}function ee(a){return i(a)&&G(a)}function ae(a){return i(a)&&(N(a)||J(a))}function te(a){return i(a)&&c(a)==="date"}function ne(a){return i(a)&&c(a)==="datetime"}function oe(a){return i(a)&&(c(a)==="enum"||c(a)==="select")}function se(a){return i(a)&&c(a)==="daterange"}function le(a){return i(a)&&c(a)==="datetimerange"}function re(a){return i(a)&&c(a)==="boolean"}function p(a){return y.dataFields.find(s=>s===a)}function ue(a){return`Has ${u(a)}`}function me(a){return(c(a)==="select"||c(a)==="enum")&&k.value[a].options.length>30}function d(a){return!y.errorMessages||!y.errorMessages[a]?"":y.errorMessages[a].map(s=>Z[s.name](s.params)).join(", ")}const{fileToBase64:M}=Ee();function ce(a){const s=Object.assign({},a);return Y.value.forEach(l=>{w(s[l])&&w(y.modelValue[l])&&ie(s[l],y.modelValue[l]).then(V=>{V&&(s[l]=null)}).catch(V=>{j.error("Error sanitizing file fields",V)})}),s}async function ie(a,s){return new Promise((l,V)=>{const e=[M(a),M(s)];Promise.all(e).then(h=>{l(h[0]===h[1])}).catch(h=>{V(h)})})}const z=O({});function g(a){return z.value[a]}function pe(a){return i(a)&&R(a)&&!!g(a)}function de(a){return i(a)&&A(a)&&!!g(a)}const S=x(()=>H.value.reduce((a,s)=>(a[s]=l=>{be(s,l)},a),{}));async function be(a,s){const l=k.value[a].limit||5;await W(a,s).then(V=>{z.value[a]=Q(a,s,l,V)})}const n=O({}),ge=x(()=>y.compact?"form compact":"form");function ve(a){return F(a)?"data-field toggleable":"data-field"}function ye(){const a=ce(n.value);C("submit",a)}function Ve(){C("cancel")}return ze(async()=>{n.value=Object.assign({},y.modelValue),await X().then(a=>{z.value=a}).catch(a=>{j.error("Error initializing options data",a)})}),(a,s)=>(r(),U("div",{class:$(t(ge))},[T("div",$e,[(r(!0),U(_,null,E(v.fieldsLayout,(l,V)=>(r(),U("div",{key:V,class:"data-row"},[(r(!0),U(_,null,E(Object.keys(l),(e,h)=>Oe(a.$slots,`form-col.${e}`,_e({key:h},{field:e,type:t(c)(e),label:t(u)(e)}),()=>[T("div",{class:$(ve(e))},[T("div",Ie,[f(e)?(r(),b(t(Te),{key:0,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,type:t(c)(e),label:t(u)(e),size:l[e],disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","type","label","size","disabled","error-message"])):m("",!0),ee(e)?(r(),b(t(Be),{key:1,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),size:l[e],disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","size","disabled","error-message"])):m("",!0),ae(e)?(r(),b(t(Ce),{key:2,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):m("",!0),te(e)?(r(),b(t(we),{key:3,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"align-pickers":"top","error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):m("",!0),ne(e)?(r(),b(t(je),{key:4,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"display-time":!0,"align-pickers":"top","error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):m("",!0),oe(e)?(r(),b(t(Me),{key:5,id:e,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:e,options:t(k)[e].options,size:l[e],disabled:!p(e),searchable:me(e),"error-message":d(e)},null,8,["id","modelValue","onUpdate:modelValue","label","name","options","size","disabled","searchable","error-message"])):m("",!0),pe(e)?(r(),b(t(I),{key:6,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:t(u)(e),multiple:!1,options:g(e).data,"options-length":g(e).total,"options-loading":g(e).loading,pagination:g(e).pagination,size:l[e],disabled:!p(e),"error-message":d(e),onOffsetChange:t(S)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):m("",!0),de(e)?(r(),b(t(I),{key:7,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:t(u)(e),options:g(e).data,"options-length":g(e).total,"options-loading":g(e).loading,pagination:g(e).pagination,size:l[e],disabled:!p(e),"error-message":d(e),onOffsetChange:t(S)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):m("",!0),se(e)&&n.value[e]?(r(),b(t(Se),{key:8,"start-date":n.value[e].startDate,"onUpdate:startDate":o=>n.value[e].startDate=o,"end-date":n.value[e].endDate,"onUpdate:endDate":o=>n.value[e].endDate=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["start-date","onUpdate:startDate","end-date","onUpdate:endDate","label","disabled","error-message"])):m("",!0),le(e)&&n.value[e]?(r(),b(t(xe),{key:9,"start-time":n.value[e].startTime,"onUpdate:startTime":o=>n.value[e].startTime=o,"end-time":n.value[e].endTime,"onUpdate:endTime":o=>n.value[e].endTime=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["start-time","onUpdate:startTime","end-time","onUpdate:endTime","label","disabled","error-message"])):m("",!0),re(e)?(r(),b(t(L),{key:10,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):m("",!0)]),t(F)(e)?(r(),U("div",Le,[B(t(L),{modelValue:D.value[e],"onUpdate:modelValue":o=>D.value[e]=o,label:ue(e)},null,8,["modelValue","onUpdate:modelValue","label"])])):m("",!0)],2)],!0)),128))]))),128))]),v.submittable?(r(),U("div",Pe,[B(t(P),{class:"button","button-type":v.confirmButton.type,value:v.confirmButton.value,icon:v.confirmButton.icon,onClick:s[0]||(s[0]=l=>ye())},null,8,["button-type","value","icon"]),B(t(P),{class:"button","button-type":v.cancelButton.type,value:v.cancelButton.value,icon:v.cancelButton.icon,onClick:s[1]||(s[1]=l=>Ve())},null,8,["button-type","value","icon"])])):m("",!0)],2))}},Re=ke(He,[["__scopeId","data-v-1db67f93"]]);export{Re as D};
