import{_ as re,s as de,u as ue,z as pe,j as fe,P as ve,r as a,c as p,o as me,b as f,d as P,m as t,n as O,v as h,H as E,h as l,x as v,e as y,g as x,y as _e,Q as he,I as ye,G as be,R as ke,U as ge,p as Ee,l as Se}from"./index-9e5b3068.js";import{T as we}from"./TabContainer-41739278.js";const o=s=>(Ee("data-v-6fa63c06"),s=s(),Se(),s),Ce={class:"preview-template"},Te={class:"template-editor"},De=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Me=[De],Pe=["contenteditable"],xe=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Re=[xe],Ve=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ne=[Ve],Le={key:0,class:"error-message"},je=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Be=[je],Ie=["contenteditable"],Oe=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Ge=[Oe],Ae=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Fe=[Ae],Ue={key:0,class:"error-message"},He=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),qe=[He],ze=["contenteditable"],Je=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),$e=[Je],Qe=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ke=[Qe],We={class:"preview-container"},Xe=o(()=>t("h3",{class:"heading"}," Preview ",-1)),Ye=["innerHTML"],Ze={class:"buttons"},et=o(()=>t("div",{class:"message"}," Generating PDF... ",-1)),tt={__name:"TemplateEditor",props:{id:{type:String,default:null},contentMarkup:{type:String,default:""},contentStyles:{type:String,default:""},disabled:{type:Boolean,default:!1},data:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},enableGenerate:{type:Boolean,default:!0},templateType:{type:String,default:null}},emits:["contentMarkupChange","contentStylesChange","dataChange"],setup(s,{emit:S}){const n=s,w=de(),G=ue(),{notEmpty:R}=pe(),C=fe(),A=new ve,F=a("style"),V=p(()=>({contentMarkup:n.contentMarkup,contentStyles:n.contentStyles})),N=a(0),U=[{label:"Markup"},{label:"Styles"},{label:"Data"}];function H(e){N.value=e}const T=a("markupEditor"),L=a("stylesEditor"),D=a("sampleDataEditor"),r=a(!1),d=a(!1),u=a(!1),q=p(()=>{const e=[];return e.push("editor"),r.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),z=p(()=>{const e=[];return e.push("editor"),d.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),J=p(()=>{const e=[];return e.push("editor"),u.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")});function $(){r.value=!0}async function Q(){_.value=!1,await M().then(e=>{ae()}).catch(e=>{_.value=!0,m.value="Markup error",C.error("Error updating markup",e)}).finally(()=>{r.value=!1})}function K(){d.value=!0}function W(){se(),d.value=!1}function X(){u.value=!0}async function Y(){_.value=!1,await M().then(e=>{ne()}).catch(e=>{_.value=!0,m.value="Sample data error",C.error("Error updating sample data",e)}).finally(()=>{u.value=!1})}function Z(){r.value=!r.value}function ee(){d.value=!d.value}function te(){u.value=!u.value}function ae(){S("contentMarkupChange",T.value.innerText)}function se(){S("contentStylesChange",L.value.innerText)}function ne(){const e=D.value.innerText;R(e)&&S("dataChange",JSON.parse(e))}const j=p(()=>n.data),oe=p(()=>_.value?"preview-content error":"preview-content"),m=a(),_=a(!1);async function M(){return new Promise((e,i)=>{m.value=null;const c=D.value.innerText;R(c)?A.parseAndRender(T.value.innerText,JSON.parse(c)).then(g=>{m.value=g,e(g)}).catch(g=>{i(g)}):e()})}const b=a(!1),k=a(),B=a(),I=a();async function le(){k.value=null,b.value=!0,await G.downloadStream(n.templateType,n.id,j.value,{path:"pdf"}).then(e=>{const i=new Blob([e.data],{type:"application/pdf"}),c=window.URL.createObjectURL(i);B.value=c,I.value=`${n.templateType}_${n.id}.pdf`,k.value=c,ie()}).catch(e=>{C.error("Error generating template",e)}).finally(()=>{ce()})}function ie(){const e=Object.assign({},w.currentRoute.value),i={path:"/document_templates/:templateType/:id/pdf",name:"View Pdf",component:()=>ge(()=>import("./PdfViewer-83246b2f.js"),["assets/PdfViewer-83246b2f.js","assets/index-9e5b3068.js","assets/index-e59a7079.css","assets/PdfViewer-652058bc.css"]),props:{templatePdfData:k.value,downloadLink:B.value,downloadFile:I.value},meta:{parentRoute:{name:e.name},hidden:!0}};w.addRoute(i),w.push({name:"View Pdf",params:{templateType:n.templateType,id:n.id}})}function ce(){b.value=!1}return me(async()=>{await M()}),(e,i)=>(f(),P("div",Ce,[t("div",Te,[O(we,{"selected-tab":N.value,tabs:U,onTabChange:H},{"tab-0":h(()=>[t("div",{class:E(l(q))},[t("div",{class:"editor-button cancel",onClick:Z},Me),t("div",{ref_key:"markupEditor",ref:T,class:"editor-content",contenteditable:r.value},v(l(V).contentMarkup),9,Pe),t("div",{class:"editor-button edit",onClick:$},Re),t("div",{class:"editor-button confirm",onClick:Q},Ne)],2),s.errorMessages.contentMarkup?(f(),P("div",Le,v(s.errorMessages.contentMarkup),1)):y("",!0)]),"tab-1":h(()=>[t("div",{class:E(l(z))},[t("div",{class:"editor-button cancel",onClick:ee},Be),t("div",{ref_key:"stylesEditor",ref:L,class:"editor-content",contenteditable:d.value},v(l(V).contentStyles),9,Ie),t("div",{class:"editor-button edit",onClick:K},Ge),t("div",{class:"editor-button confirm",onClick:W},Fe)],2),s.errorMessages.contentStyles?(f(),P("div",Ue,v(s.errorMessages.contentStyles),1)):y("",!0)]),"tab-2":h(()=>[t("div",{class:E(l(J))},[t("div",{class:"editor-button cancel",onClick:te},qe),t("div",{ref_key:"sampleDataEditor",ref:D,class:"editor-content",contenteditable:u.value},v(l(j)),9,ze),t("div",{class:"editor-button edit",onClick:X},$e),t("div",{class:"editor-button confirm",onClick:Y},Ke)],2)]),_:1},8,["selected-tab"])]),t("div",We,[Xe,t("div",{class:E(l(oe)),innerHTML:m.value},null,10,Ye),s.contentStyles?(f(),x(he(F.value),{key:0},{default:h(()=>[_e(v(s.contentStyles),1)]),_:1})):y("",!0),t("div",Ze,[s.enableGenerate?(f(),x(l(ye),{key:0,value:"Generate",icon:"fa-solid fa-file-export",onClick:le})):y("",!0)])]),O(l(ke),{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=c=>b.value=c),class:"generate-dialog",title:"Generating PDF",width:400,height:250},{body:h(()=>[k.value?y("",!0):(f(),x(l(be),{key:0})),et]),_:1},8,["modelValue"])]))}},nt=re(tt,[["__scopeId","data-v-6fa63c06"]]);export{nt as T};
