import{u as je,B as Fe,k as De,c as m,E as ke,a8 as we}from"./index-c88bb001.js";function Ee(k){const w=je(),{formatDate:G,formatTimestamp:Q}=ke(),{isEmpty:y,notEmpty:p}=Fe(),{base64ToFile:K}=we(),h=De(),u=m(()=>k.reduce((e,t)=>(e[t.key]=t,e),{})),S=m(()=>Object.values(u.value).filter(e=>e.listable)),R=m(()=>S.value.map(e=>e.key)),T=m(()=>Object.values(u.value).filter(e=>e.viewable)),W=m(()=>T.value.map(e=>e.key)),V=m(()=>Object.values(u.value).filter(e=>e.creatable)),X=m(()=>V.value.map(e=>e.key)),P=m(()=>Object.values(u.value).filter(e=>e.updatable)),Y=m(()=>P.value.map(e=>e.key)),A=m(()=>Object.values(u.value).filter(e=>e.sortable)),Z=m(()=>A.value.map(e=>e.key)),_=m(()=>Object.values(u.value).some(e=>e.type==="file")),I=m(()=>Object.keys(u.value).filter(e=>F(e))),d=m(()=>Object.keys(u.value).filter(e=>J(e))),$=m(()=>Object.keys(u.value).filter(e=>D(e))),x=m(()=>Object.keys(u.value).filter(e=>v(e))),C=m(()=>Object.keys(u.value).filter(e=>g(e))),ee=m(()=>Object.keys(u.value).filter(e=>N(e))),te=m(()=>Object.keys(u.value).filter(e=>B(e))),L=m(()=>Object.keys(u.value).filter(e=>E(e))),M=m(()=>Object.keys(u.value).filter(e=>H(e))),z=m(()=>Object.keys(u.value).filter(e=>j(e))),ne=m(()=>k.filter(e=>e.reference||e.file)),ae=m(()=>ne.value.map(e=>e.key));function o(e){return(u.value[e]||{}).type}function re(e){return(u.value[e]||{}).label}function se(e,t,n,a,r){const i=n.find(s=>s===e),c=t[e];if(!y(c))if(p(i)&&!j(e)){const s=t.includes||{},f=[c].flat().filter(b=>!!b).map(b=>{if(y(s[e]))return b;const O=s[e][b];return y(O)?b:u.value[e].reference.label(O)});return v(e)?f:f[0]}else{if(o(e)==="enum"||o(e)==="select")return a.find(f=>f.key===e).options.find(f=>f.value===c).label;if(o(e)==="datetime")return Q(c,r.timezone);if(o(e)==="date")return G(c,r.timezone);if(j(e)){const s=t.includes||{};if(y(s[e]))return;const l=s[e][c];return y(l)?void 0:l.rawData}else return c}}function ue(e){return o(e)==="text"||o(e)==="number"}function ce(e){return o(e)==="textarea"}function v(e){return o(e)==="multiSelect"}function g(e){return o(e)==="singleSelect"}function F(e){return o(e)==="select"||o(e)==="enum"}function D(e){return o(e)==="select"||o(e)==="multiSelect"||o(e)==="singleSelect"||o(e)==="enum"}function J(e){return D(e)&&u.value[e].options&&u.value[e].options.server}function N(e){return u.value[e].nullToggleable}function B(e){return e==="tags"||Object.is(u.value[e].isTags,!0)}function E(e){return o(e)==="object"}function H(e){return o(e)==="number"}function j(e){return o(e)==="file"}function U(e,t,n,a){return Object.assign({},{loading:!1,pagination:{offset:t,limit:n,client:!1}},a)}function le(e){return k.map(t=>{if(t.type==="enum"){const n=e[t.key].enums,a=Object.keys(n).map(i=>({value:i,label:n[i]}));return Object.assign({},t,{options:a})}else return t})}function oe(e,t){return Object.keys(e).reduce((n,a)=>{const i=e[a].map(c=>c(t)).filter(c=>!!c);return i.length>0&&(n[a]=i),n},{})}async function ie(e,t){return w.view(e,t,{})}async function me(e,t){const n=u.value[e].options,a=n.modelClass,r=t.map(i=>ie(a,i));return new Promise((i,c)=>{Promise.all(r).then(s=>{const l=s.map(f=>{const b=n.value(f),O=n.label(f);return{value:b,label:O}});i(l)}).catch(s=>{h.error("Error loading includes from server",s),c(s)})})}function fe(e,t){const n=t[e];if(p(n))return n;const a=u.value[e].defaultValue;return p(a)?a():n}async function pe(e,t){return new Promise((n,a)=>{const r=fe(e,t);if(y(r)){n(r);return}if(E(e)){p(r)?n(JSON.stringify(r,!1,4)):n(r);return}if(j(e)){const c=u.value[e].file;if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];K(s.rawData,s.filename,s.mimeType).then(l=>{n(l)}).catch(l=>{h.error("Error converting base64 to file",{error:l}),n(null)})}else w.view(c.modelClass,r,{}).then(s=>{K(s.rawData,s.filename,s.mimeType).then(l=>{y(t.includes)&&(t.includes={}),y(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,n(l)}).catch(l=>{h.error("Error converting base64 to file",{error:l}),n(null)})}).catch(s=>{h.error("Error formatting data for show",s),n(null)});return}if(o(e)!=="date"&&o(e)!=="datetime"&&!v(e)&&!g(e)){n(r);return}if(o(e)==="date"||o(e)==="datetime"){let c;r instanceof Date||typeof r=="string"?c=new Date(r):c=Object.entries(r).reduce((s,[l,f])=>(p(f)?s[l]=new Date(f):s[l]=f,s),{}),n(c);return}const i=[r].flat();if((g(e)||v(e))&&Array.isArray(u.value[e].options)){const c=u.value[e].options,s=i.map(l=>{const f=c.find(b=>b.value===l);return{value:f.value,label:f.label}});n(s);return}if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const c=t.includes[e],s=i.map(l=>{const f=c[l],b=u.value[e].options,O=b.value(f),he=b.label(f);return{value:O,label:he}});n(s)}else me(e,i).then(c=>{n(c)}).catch(c=>{h.error("Error formatting data for show",c);const s=[];i.forEach(l=>{p(l)&&s.push({value:l,label:l})}),n(s)})})}function be(e){const t=Object.assign({},e);return x.value.forEach(a=>{const r=t[a]||[];t[a]=r.map(i=>i.value)}),C.value.forEach(a=>{const r=t[a]||[];t[a]=(r[0]||{}).value||""}),I.value.forEach(a=>{const r=t[a];(y(r)||r.length===0)&&(t[a]="")}),L.value.forEach(a=>{p(t[a])&&t[a].length>0?t[a]=JSON.parse(t[a]):t[a]={}}),z.value.forEach(a=>{const r=t[a];y(r)&&(t[a]="")}),M.value.forEach(a=>{const r=t[a];p(r)&&(t[a]=parseFloat(r))}),Object.entries(t).reduce((a,[r,i])=>(Object.is(i,void 0)?a[r]=null:a[r]=i,a),{})}function ye(e){return Object.entries(e).reduce((t,[n,a])=>(t[n]=a.map(r=>({name:r,params:{}})),t),{})}function ve(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)?t[n]=a:F(n)&&a.length>0?t[n]=a[0].value:(v(n)||g(n))&&a.length>0?t[n]=a.map(r=>r.value):t[n]=a,t),{})}function ge(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)||D(n)&&a.length===0||((F(n)||g(n))&&a.length>0?t[n]=a[0].value:v(n)&&a.length>0?t[n]=a.map(r=>r.value):o(n)==="date"?(p(a.startDate)&&(t[n]={},t[n].startDate=a.startDate),p(a.endDate)&&(y(t[n])&&(t[n]={}),t[n].endDate=a.endDate)):o(n)==="datetime"?(p(a.startTime)&&(t[n]={},t[n].startTime=a.startTime),p(a.endTime)&&(y(t[n])&&(t[n]={}),t[n].endTime=a.endTime)):t[n]=a),t),{})}async function q(e,t){const n=u.value[e].options||{};if(n.server){const a=n.limit||5;return new Promise((r,i)=>{w.list(n.modelClass,{offset:t,limit:a}).then(c=>{const s=c.data,f={total:c.total,data:s.map(b=>({value:n.value(b),label:n.label(b)}))};r(U(e,t,a,f))})})}else return new Promise((a,r)=>{a(Object.assign({},{data:n,total:n.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function Oe(){return new Promise((e,t)=>{Promise.all(d.value.map(n=>{const a=u.value[n].offset||0;return q(n,a)})).then(n=>{const a={};n.forEach((r,i)=>{const c=d.value[i];a[c]=r}),e(a)}).catch(n=>{t(n)})})}return{schemasMap:u,listableFields:S,listableKeys:R,viewableFields:T,viewableKeys:W,creatableFields:V,creatableKeys:X,updatableFields:P,updatableKeys:Y,sortableFields:A,sortableKeys:Z,multipartData:_,clientOptionsKeys:I,clientOptionsField:F,serverOptionsKeys:d,serverOptionsField:J,selectableKeys:$,multiSelectableKeys:x,singleSelectableKeys:C,inputType:o,inputLabel:re,inputValue:se,inputableField:ue,multiInputableField:ce,multiSelectableField:v,singleSelectableField:g,selectableField:D,nullToggleableField:N,nullToggleableKeys:ee,tagsField:B,tagsKeys:te,objectField:E,objectKeys:L,numberField:H,numberKeys:M,fileField:j,fileKeys:z,includeKeys:ae,formatInputOptionsData:U,formatDataFields:le,formatDataForShow:pe,formatDataForSave:be,formatErrorsForDisplay:ye,formatFiltersForShow:ve,formatFiltersForLoad:ge,validateParams:oe,fetchOptions:q,initOptionsData:Oe}}export{Ee as u};
