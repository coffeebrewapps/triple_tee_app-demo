import{u as he,B as Fe,k as De,c as m,E as ke,a8 as de}from"./index-66a5b31b.js";function Ke(D){const k=he(),{formatDate:U,formatTimestamp:q}=ke(),{isEmpty:y,notEmpty:p}=Fe(),{base64ToFile:S}=de(),d=De(),u=m(()=>D.reduce((e,t)=>(e[t.key]=t,e),{})),T=m(()=>Object.values(u.value).filter(e=>e.listable)),G=m(()=>T.value.map(e=>e.key)),V=m(()=>Object.values(u.value).filter(e=>e.viewable)),Q=m(()=>V.value.map(e=>e.key)),E=m(()=>Object.values(u.value).filter(e=>e.creatable)),R=m(()=>E.value.map(e=>e.key)),P=m(()=>Object.values(u.value).filter(e=>e.updatable)),W=m(()=>P.value.map(e=>e.key)),A=m(()=>Object.values(u.value).filter(e=>e.sortable)),X=m(()=>A.value.map(e=>e.key)),Y=m(()=>Object.values(u.value).some(e=>e.type==="file")),I=m(()=>Object.keys(u.value).filter(e=>h(e))),w=m(()=>Object.keys(u.value).filter(e=>M(e))),Z=m(()=>Object.keys(u.value).filter(e=>F(e))),x=m(()=>Object.keys(u.value).filter(e=>g(e))),C=m(()=>Object.keys(u.value).filter(e=>O(e))),_=m(()=>Object.keys(u.value).filter(e=>z(e))),$=m(()=>Object.keys(u.value).filter(e=>J(e))),L=m(()=>Object.keys(u.value).filter(e=>K(e))),ee=m(()=>Object.keys(u.value).filter(e=>N(e))),te=m(()=>Object.keys(u.value).filter(e=>j(e))),ne=m(()=>D.filter(e=>e.reference||e.file)),ae=m(()=>ne.value.map(e=>e.key));function c(e){return(u.value[e]||{}).type}function re(e){return(u.value[e]||{}).label}function se(e,t,n,a,r){const o=n.find(s=>s===e),l=t[e];if(!y(l))if(p(o)&&!j(e)){const s=t.includes||{},f=[l].flat().filter(b=>!!b).map(b=>{if(y(s[e]))return b;const v=s[e][b];return y(v)?b:u.value[e].reference.label(v)});return g(e)?f:f[0]}else{if(c(e)==="enum"||c(e)==="select")return a.find(f=>f.key===e).options.find(f=>f.value===l).label;if(c(e)==="datetime")return q(l,r.timezone);if(c(e)==="date")return U(l,r.timezone);if(j(e)){const s=t.includes||{};if(y(s[e]))return;const i=s[e][l];return y(i)?void 0:i.rawData}else return l}}function ue(e){return c(e)==="text"||c(e)==="number"}function le(e){return c(e)==="textarea"}function g(e){return c(e)==="multiSelect"}function O(e){return c(e)==="singleSelect"}function h(e){return c(e)==="select"||c(e)==="enum"}function F(e){return c(e)==="select"||c(e)==="multiSelect"||c(e)==="singleSelect"||c(e)==="enum"}function M(e){return F(e)&&u.value[e].options&&u.value[e].options.server}function z(e){return u.value[e].nullToggleable}function J(e){return e==="tags"||Object.is(u.value[e].isTags,!0)}function K(e){return c(e)==="object"}function N(e){return c(e)==="number"}function j(e){return c(e)==="file"}function B(e,t,n,a){return Object.assign({},{loading:!1,pagination:{offset:t,limit:n,client:!1}},a)}function ce(e){return D.map(t=>{if(t.type==="enum"){const n=e[t.key].enums,a=Object.keys(n).map(o=>({value:o,label:n[o]}));return Object.assign({},t,{options:a})}else return t})}function oe(e,t){return Object.keys(e).reduce((n,a)=>{const o=e[a].map(l=>l(t)).filter(l=>!!l);return o.length>0&&(n[a]=o),n},{})}async function ie(e,t){return k.view(e,t,{})}async function me(e,t){const n=u.value[e].options,a=n.modelClass,r=t.map(o=>ie(a,o));return new Promise((o,l)=>{Promise.all(r).then(s=>{const i=s.map(f=>{const b=n.value(f),v=n.label(f);return{value:b,label:v}});o(i)}).catch(s=>{d.error("Error loading includes from server",s),l(s)})})}function fe(e,t){const n=t[e];if(p(n))return n;const a=u.value[e].defaultValue;return p(a)?a():n}async function pe(e,t){return new Promise((n,a)=>{const r=fe(e,t);if(y(r)){n(r);return}if(K(e)){p(r)?n(JSON.stringify(r,!1,4)):n(r);return}if(j(e)){const l=u.value[e].file;if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];S(s.rawData,s.filename,s.mimeType).then(i=>{n(i)}).catch(i=>{n(null)})}else k.view(l.modelClass,r,{}).then(s=>{S(s.rawData,s.filename,s.mimeType).then(i=>{y(t.includes)&&(t.includes={}),y(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,n(i)}).catch(i=>{n(null)})}).catch(s=>{d.error("Error formatting data for show",s),n(null)});return}if(c(e)!=="date"&&c(e)!=="datetime"&&!g(e)&&!O(e)){n(r);return}if(c(e)==="date"||c(e)==="datetime"){let l;r instanceof Date||typeof r=="string"?l=new Date(r):l=Object.entries(r).reduce((s,[i,f])=>(p(f)?s[i]=new Date(f):s[i]=f,s),{}),n(l);return}const o=[r].flat();if((O(e)||g(e))&&Array.isArray(u.value[e].options)){const l=u.value[e].options,s=o.map(i=>{const f=l.find(b=>b.value===i);return{value:f.value,label:f.label}});n(s);return}if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const l=t.includes[e],s=o.map(i=>{const f=l[i],b=u.value[e].options,v=b.value(f),je=b.label(f);return{value:v,label:je}});n(s)}else me(e,o).then(l=>{n(l)}).catch(l=>{d.error("Error formatting data for show",l);const s=[];o.forEach(i=>{p(i)&&s.push({value:i,label:i})}),n(s)})})}function be(e){const t=Object.assign({},e);return x.value.forEach(a=>{const r=t[a]||[];t[a]=r.map(o=>o.value)}),C.value.forEach(a=>{const r=t[a]||[];t[a]=(r[0]||{}).value}),I.value.forEach(a=>{const r=t[a];(y(r)||r.length===0)&&(t[a]=null)}),L.value.forEach(a=>{p(t[a])&&t[a].length>0?t[a]=JSON.parse(t[a]):t[a]={}}),Object.entries(t).reduce((a,[r,o])=>(Object.is(o,void 0)?a[r]=null:a[r]=o,a),{})}function ye(e){return Object.entries(e).reduce((t,[n,a])=>(t[n]=a.map(r=>({name:r,params:{}})),t),{})}function ge(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)?t[n]=a:h(n)&&a.length>0?t[n]=a[0].value:(g(n)||O(n))&&a.length>0?t[n]=a.map(r=>r.value):t[n]=a,t),{})}function Oe(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)||F(n)&&a.length===0||((h(n)||O(n))&&a.length>0?t[n]=a[0].value:g(n)&&a.length>0?t[n]=a.map(r=>r.value):c(n)==="date"?(p(a.startDate)&&(t[n]={},t[n].startDate=a.startDate),p(a.endDate)&&(y(t[n])&&(t[n]={}),t[n].endDate=a.endDate)):c(n)==="datetime"?(p(a.startTime)&&(t[n]={},t[n].startTime=a.startTime),p(a.endTime)&&(y(t[n])&&(t[n]={}),t[n].endTime=a.endTime)):t[n]=a),t),{})}async function H(e,t){const n=u.value[e].options||{};if(n.server){const a=n.limit||5;return new Promise((r,o)=>{k.list(n.modelClass,{offset:t,limit:a}).then(l=>{const s=l.data,f={total:l.total,data:s.map(b=>({value:n.value(b),label:n.label(b)}))};r(B(e,t,a,f))})})}else return new Promise((a,r)=>{a(Object.assign({},{data:n,total:n.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ve(){return new Promise((e,t)=>{Promise.all(w.value.map(n=>{const a=u.value[n].offset||0;return H(n,a)})).then(n=>{const a={};n.forEach((r,o)=>{const l=w.value[o];a[l]=r}),e(a)}).catch(n=>{t(n)})})}return{schemasMap:u,listableFields:T,listableKeys:G,viewableFields:V,viewableKeys:Q,creatableFields:E,creatableKeys:R,updatableFields:P,updatableKeys:W,sortableFields:A,sortableKeys:X,multipartData:Y,clientOptionsKeys:I,clientOptionsField:h,serverOptionsKeys:w,serverOptionsField:M,selectableKeys:Z,multiSelectableKeys:x,singleSelectableKeys:C,inputType:c,inputLabel:re,inputValue:se,inputableField:ue,multiInputableField:le,multiSelectableField:g,singleSelectableField:O,selectableField:F,nullToggleableField:z,nullToggleableKeys:_,tagsField:J,tagsKeys:$,objectField:K,objectKeys:L,numberField:N,numberKeys:ee,fileField:j,fileKeys:te,includeKeys:ae,formatInputOptionsData:B,formatDataFields:ce,formatDataForShow:pe,formatDataForSave:be,formatErrorsForDisplay:ye,formatFiltersForShow:ge,formatFiltersForLoad:Oe,validateParams:oe,fetchOptions:H,initOptionsData:ve}}export{Ke as u};
