import{u as Ue}from"./input-0d8e93b0.js";import{u as ke}from"./errors-29306128.js";import{_ as Fe,v as De,b as Oe,r as C,d as L,w as S,e as ze,o as r,c as U,k as T,F as I,x as _,I as Ce,D as $,g as b,h as t,L as Te,f as c,a0 as Be,H as we,a1 as je,a2 as xe,Y as Me,X as P,a3 as Ee,a4 as Le,a5 as H,l as B,$ as Se,C as A,a6 as Ie}from"./index-c658bd47.js";const _e={class:"body"},$e={class:"field-input"},Pe={key:0,class:"field-toggle"},He={key:0,class:"actions"},Ae={__name:"DataForm",props:{modelValue:{type:Object,default(){return{}}},fieldsLayout:{type:Array,default(){return[]}},dataFields:{type:Array,default(){return[]}},schemas:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},compact:{type:Boolean,default:!1},submittable:{type:Boolean,default:!0},confirmButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-check",value:"Confirm"}}},cancelButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-xmark",value:"Cancel"}}}},emits:["update:modelValue","submit","cancel"],setup(V,{emit:k}){const g=V,{schemasMap:F,serverOptionsFields:N,inputType:m,inputLabel:u,inputableField:R,multiInputableField:Y,multiSelectableField:G,singleSelectableField:K,nullToggleableField:D,nullToggleableFields:X,objectField:q,fileFields:J,fileField:Q,formatInputOptionsData:W,fetchOptions:Z,initOptionsData:f}=Ue(g.schemas),{notEmpty:w}=De(),j=Oe(),ee=ke(),O=C(X.value.reduce((a,s)=>(a[s]=!1,a),{}));function i(a){return!D(a)||O.value[a]}function ae(a){return i(a)&&R(a)}function te(a){return i(a)&&Q(a)}function ne(a){return i(a)&&(Y(a)||q(a))}function oe(a){return i(a)&&m(a)==="date"}function se(a){return i(a)&&m(a)==="datetime"}function le(a){return i(a)&&(m(a)==="enum"||m(a)==="select")}function re(a){return i(a)&&m(a)==="daterange"}function ue(a){return i(a)&&m(a)==="datetimerange"}function ce(a){return i(a)&&m(a)==="boolean"}function p(a){return g.dataFields.find(s=>s===a)}function me(a){return`Has ${u(a)}`}function ie(a){return(m(a)==="select"||m(a)==="enum")&&F.value[a].options.length>30}function d(a){return!g.errorMessages||!g.errorMessages[a]?"":g.errorMessages[a].map(s=>ee[s.name](s.params)).join(", ")}const{fileToBase64:x}=Ie();function M(a){const s=Object.assign({},a);return J.value.forEach(l=>{w(s[l])&&w(g.modelValue[l])&&pe(s[l],g.modelValue[l]).then(y=>{y&&(s[l]=null)}).catch(y=>{j.error("Error sanitizing file fields",y)})}),s}async function pe(a,s){return new Promise((l,y)=>{const e=[x(a),x(s)];Promise.all(e).then(h=>{l(h[0]===h[1])}).catch(h=>{y(h)})})}const z=C({});function v(a){return z.value[a]}function de(a){return i(a)&&K(a)&&!!v(a)}function be(a){return i(a)&&G(a)&&!!v(a)}const E=L(()=>N.value.reduce((a,s)=>(a[s]=l=>{ge(s,l)},a),{}));async function ge(a,s){const l=F.value[a].limit||5;await Z(a,s).then(y=>{z.value[a]=W(a,s,l,y)})}const n=C({});S(g.modelValue,(a,s)=>{n.value=Object.assign({},a)}),S(n,(a,s)=>{const l=M(a);k("update:modelValue",l)},{deep:!0});const ve=L(()=>g.compact?"form compact":"form");function Ve(a){return D(a)?"data-field toggleable":"data-field"}function ye(){const a=M(n.value);k("submit",a)}function he(){k("cancel")}return ze(async()=>{n.value=Object.assign({},g.modelValue),await f().then(a=>{z.value=a}).catch(a=>{j.error("Error initializing options data",a)})}),(a,s)=>(r(),U("div",{class:$(t(ve))},[T("div",_e,[(r(!0),U(I,null,_(V.fieldsLayout,(l,y)=>(r(),U("div",{key:y,class:"data-row"},[(r(!0),U(I,null,_(Object.keys(l),(e,h)=>Ce(a.$slots,`form-col.${e}`,Se({key:h},{field:e,type:t(m)(e),label:t(u)(e)}),()=>[T("div",{class:$(Ve(e))},[T("div",$e,[ae(e)?(r(),b(t(Te),{key:0,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,type:t(m)(e),label:t(u)(e),size:l[e],disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","type","label","size","disabled","error-message"])):c("",!0),te(e)?(r(),b(t(Be),{key:1,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),size:l[e],disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","size","disabled","error-message"])):c("",!0),ne(e)?(r(),b(t(we),{key:2,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):c("",!0),oe(e)?(r(),b(t(je),{key:3,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"align-pickers":"top","error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):c("",!0),se(e)?(r(),b(t(xe),{key:4,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"display-time":!0,"align-pickers":"top","error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):c("",!0),le(e)?(r(),b(t(Me),{key:5,id:e,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:e,options:t(F)[e].options,size:l[e],disabled:!p(e),searchable:ie(e),"error-message":d(e)},null,8,["id","modelValue","onUpdate:modelValue","label","name","options","size","disabled","searchable","error-message"])):c("",!0),de(e)?(r(),b(t(P),{key:6,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:t(u)(e),multiple:!1,options:v(e).data,"options-length":v(e).total,"options-loading":v(e).loading,pagination:v(e).pagination,size:l[e],disabled:!p(e),"error-message":d(e),onOffsetChange:t(E)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):c("",!0),be(e)?(r(),b(t(P),{key:7,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),name:t(u)(e),options:v(e).data,"options-length":v(e).total,"options-loading":v(e).loading,pagination:v(e).pagination,size:l[e],disabled:!p(e),"error-message":d(e),onOffsetChange:t(E)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):c("",!0),re(e)&&n.value[e]?(r(),b(t(Ee),{key:8,"start-date":n.value[e].startDate,"onUpdate:startDate":o=>n.value[e].startDate=o,"end-date":n.value[e].endDate,"onUpdate:endDate":o=>n.value[e].endDate=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["start-date","onUpdate:startDate","end-date","onUpdate:endDate","label","disabled","error-message"])):c("",!0),ue(e)&&n.value[e]?(r(),b(t(Le),{key:9,"start-time":n.value[e].startTime,"onUpdate:startTime":o=>n.value[e].startTime=o,"end-time":n.value[e].endTime,"onUpdate:endTime":o=>n.value[e].endTime=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["start-time","onUpdate:startTime","end-time","onUpdate:endTime","label","disabled","error-message"])):c("",!0),ce(e)?(r(),b(t(H),{key:10,modelValue:n.value[e],"onUpdate:modelValue":o=>n.value[e]=o,label:t(u)(e),disabled:!p(e),"error-message":d(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):c("",!0)]),t(D)(e)?(r(),U("div",Pe,[B(t(H),{modelValue:O.value[e],"onUpdate:modelValue":o=>O.value[e]=o,label:me(e)},null,8,["modelValue","onUpdate:modelValue","label"])])):c("",!0)],2)],!0)),128))]))),128))]),V.submittable?(r(),U("div",He,[B(t(A),{class:"button","button-type":V.confirmButton.type,value:V.confirmButton.value,icon:V.confirmButton.icon,onClick:s[0]||(s[0]=l=>ye())},null,8,["button-type","value","icon"]),B(t(A),{class:"button","button-type":V.cancelButton.type,value:V.cancelButton.value,icon:V.cancelButton.icon,onClick:s[1]||(s[1]=l=>he())},null,8,["button-type","value","icon"])])):c("",!0)],2))}},Ge=Fe(Ae,[["__scopeId","data-v-ec0a582d"]]);export{Ge as D};
