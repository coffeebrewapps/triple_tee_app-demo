import{a as ye,x as Oe,b as ge,d as c,A as Fe,a6 as je}from"./index-2931c377.js";const w=ye(),{formatDate:he,formatTimestamp:ke}=Fe(),{isEmpty:g,notEmpty:b}=Oe(),{base64ToFile:q}=je(),D=ge();function De(F){const u=c(()=>F.reduce((e,t)=>(e[t.key]=t,e),{})),V=c(()=>Object.values(u.value).filter(e=>e.listable)),B=c(()=>V.value.map(e=>e.key)),E=c(()=>Object.values(u.value).filter(e=>e.viewable)),G=c(()=>E.value.map(e=>e.key)),S=c(()=>Object.values(u.value).filter(e=>e.creatable)),Q=c(()=>S.value.map(e=>e.key)),T=c(()=>Object.values(u.value).filter(e=>e.updatable)),R=c(()=>T.value.map(e=>e.key)),P=c(()=>Object.values(u.value).filter(e=>e.sortable)),W=c(()=>P.value.map(e=>e.key)),X=c(()=>Object.values(u.value).some(e=>e.type==="file")),K=c(()=>Object.keys(u.value).filter(e=>M(e))),j=c(()=>Object.keys(u.value).filter(e=>z(e))),Y=c(()=>Object.keys(u.value).filter(e=>h(e))),I=c(()=>Object.keys(u.value).filter(e=>v(e))),x=c(()=>Object.keys(u.value).filter(e=>O(e))),Z=c(()=>Object.keys(u.value).filter(e=>J(e))),_=c(()=>Object.keys(u.value).filter(e=>L(e))),A=c(()=>Object.keys(u.value).filter(e=>k(e))),C=c(()=>Object.keys(u.value).filter(e=>N(e))),$=c(()=>Object.keys(u.value).filter(e=>d(e))),ee=c(()=>F.filter(e=>e.reference||e.file)),te=c(()=>ee.value.map(e=>e.key));function o(e){return(u.value[e]||{}).type}function ne(e){return(u.value[e]||{}).label}function ae(e,t,a,n,r){const i=a.find(s=>s===e),l=t[e];if(!g(l))if(b(i)&&!d(e)){const s=t.includes||{},f=[l].flat().filter(p=>!!p).map(p=>{const y=s[e][p];return u.value[e].reference.label(y)});return v(e)?f:f[0]}else return o(e)==="enum"||o(e)==="select"?n.find(f=>f.key===e).options.find(f=>f.value===l).label:o(e)==="datetime"?ke(l,r.timezone):o(e)==="date"?he(l,r.timezone):d(e)?((t.includes||{})[e][l]||{}).rawData:l}function re(e){return o(e)==="text"||o(e)==="number"}function se(e){return o(e)==="textarea"}function v(e){return o(e)==="multiSelect"}function O(e){return o(e)==="singleSelect"}function M(e){return o(e)==="select"||o(e)==="enum"}function h(e){return o(e)==="select"||o(e)==="multiSelect"||o(e)==="singleSelect"||o(e)==="enum"}function z(e){return h(e)&&u.value[e].options&&u.value[e].options.server}function J(e){return u.value[e].nullToggleable}function L(e){return e==="tags"||Object.is(u.value[e].isTags,!0)}function k(e){return o(e)==="object"}function N(e){return o(e)==="number"}function d(e){return o(e)==="file"}function H(e,t,a,n){return Object.assign({},{loading:!1,pagination:{offset:t,limit:a,client:!1}},n)}function ue(e){return F.map(t=>{if(t.type==="enum"){const a=e[t.key].enums,n=Object.keys(a).map(i=>({value:i,label:a[i]}));return Object.assign({},t,{options:n})}else return t})}function le(e,t){return Object.keys(e).reduce((a,n)=>{const i=e[n].map(l=>l(t)).filter(l=>!!l);return i.length>0&&(a[n]=i),a},{})}async function ce(e,t){return w.view(e,t,{})}async function oe(e,t){const a=u.value[e].options,n=a.modelClass,r=t.map(i=>ce(n,i));return new Promise((i,l)=>{Promise.all(r).then(s=>{const m=s.map(f=>{const p=a.value(f),y=a.label(f);return{value:p,label:y}});i(m)}).catch(s=>{D.error("Error loading includes from server",s),l(s)})})}function ie(e,t){const a=t[e];if(b(a))return a;const n=u.value[e].defaultValue;return b(n)?n():a}async function me(e,t){return new Promise((a,n)=>{const r=ie(e,t);if(g(r)){a(r);return}if(k(e)){b(r)?a(JSON.stringify(r,!1,4)):a(r);return}if(d(e)){const l=u.value[e].file;if(b(t.includes)&&b(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];q(s.rawData,s.filename,s.mimeType).then(m=>{a(m)}).catch(m=>{n(m)})}else w.view(l.modelClass,r,{}).then(s=>{g(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,q(s.rawData,s.filename,s.mimeType).then(m=>{a(m)}).catch(m=>{n(m)})}).catch(s=>{D.error("Error formatting data for show",s),a(r)});return}if(o(e)!=="date"&&o(e)!=="datetime"&&!v(e)&&!O(e)){a(r);return}if(o(e)==="date"||o(e)==="datetime"){let l;r instanceof Date||typeof r=="string"?l=new Date(r):l=Object.entries(r).reduce((s,[m,f])=>(b(f)?s[m]=new Date(f):s[m]=f,s),{}),a(l);return}const i=[r].flat();if(b(t.includes)&&b(t.includes[e])&&Object.keys(t.includes[e]).length>0){const l=t.includes[e],s=i.map(m=>{const f=l[m],p=u.value[e].options,y=p.value(f),de=p.label(f);return{value:y,label:de}});a(s)}else oe(e,i).then(l=>{a(l)}).catch(l=>{D.error("Error formatting data for show",l);const s=[];i.forEach(m=>{b(m)&&s.push({value:m,label:m})}),a(s)})})}function fe(e){const t=Object.assign({},e);return I.value.forEach(n=>{const r=t[n]||[];t[n]=r.map(i=>i.value)}),x.value.forEach(n=>{const r=t[n]||[];t[n]=(r[0]||{}).value}),K.value.forEach(n=>{const r=t[n];(g(r)||r.length===0)&&(t[n]=null)}),A.value.forEach(n=>{b(t[n])&&t[n].length>0&&(t[n]=JSON.parse(t[n]))}),C.value.forEach(n=>{b(t[n])&&(t[n]=parseFloat(t[n]))}),Object.entries(t).reduce((n,[r,i])=>(Object.is(i,void 0)?n[r]=null:n[r]=i,n),{})}function be(e){return Object.entries(e).reduce((t,[a,n])=>(t[a]=n.map(r=>({name:r,params:{}})),t),{})}function pe(e={}){return Object.entries(e).reduce((t,[a,n])=>(b(n)&&n!==""&&(O(a)?t[a]=n[0].value:v(a)?t[a]=n.map(r=>r.value):t[a]=n),t),{})}async function U(e,t){const a=u.value[e].options||{};if(a.server){const n=a.limit||5;return new Promise((r,i)=>{w.list(a.modelClass,{offset:t,limit:n}).then(l=>{const s=l.data,f={total:l.total,data:s.map(p=>({value:a.value(p),label:a.label(p)}))};r(H(e,t,n,f))})})}else return new Promise((n,r)=>{n(Object.assign({},{data:a,total:a.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ve(){return new Promise((e,t)=>{Promise.all(j.value.map(a=>{const n=u.value[a].offset||0;return U(a,n)})).then(a=>{const n={};a.forEach((r,i)=>{const l=j.value[i];n[l]=r}),e(n)}).catch(a=>{t(a)})})}return{schemasMap:u,listableFields:V,listableKeys:B,viewableFields:E,viewableKeys:G,creatableFields:S,creatableKeys:Q,updatableFields:T,updatableKeys:R,sortableFields:P,sortableKeys:W,multipartData:X,clientOptionsFields:K,clientOptionsField:M,serverOptionsFields:j,serverOptionsField:z,selectableKeys:Y,multiSelectableFields:I,singleSelectableFields:x,inputType:o,inputLabel:ne,inputValue:ae,inputableField:re,multiInputableField:se,multiSelectableField:v,singleSelectableField:O,selectableField:h,nullToggleableField:J,nullToggleableFields:Z,tagsField:L,tagsFields:_,objectField:k,objectFields:A,numberField:N,numberFields:C,fileField:d,fileFields:$,includeKeys:te,formatInputOptionsData:H,formatDataFields:ue,formatDataForShow:me,formatDataForSave:fe,formatErrorsForDisplay:be,formatFilters:pe,validateParams:le,fetchOptions:U,initOptionsData:ve}}export{De as u};
