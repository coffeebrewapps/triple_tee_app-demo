import{D as L}from"./DataForm-b39fb97f.js";import{_ as U,u as j,v as M,j as N,r as l,c as y,o as P,d as g,e as T,h as $,i as v,f as A,n as K,q as O,z as q}from"./index-61869e54.js";import{u as H}from"./input-2a619ab7.js";import"./errors-ebd9927f.js";const R={class:"view-container"},Z={class:"actions"},G={__name:"SystemConfigs",setup(J){const n=j(),_=M(),{flashMessage:r}=N(),s=l(),c=l({}),u=y(()=>o.value.filter(e=>e.updatable)),i=y(()=>u.value.map(e=>e.key)),C=[{tagFormat:"md",timezone:"lg"},{baseCurrencyId:"lg",baseContactId:"lg"}];function d(e){return e.id}function m(e){return`${e.code} (${e.symbol})`}function f(e){return e.name}const h=Intl.supportedValuesOf("timeZone").map(e=>{const a=e.replace(/_/g," ");return{value:e,label:a}}),o=l([{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"select",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0,options:h},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:m},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:d,label:m}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:f},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:d,label:f}}]),{formatDataForShow:k,formatDataForSave:S,formatErrorsForDisplay:w}=H(o.value);function F(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function D(){const e=S(Object.assign({},s.value));await n.create("system_configs",e,{path:"replace"}).then(a=>{r("Updated config successfully!"),_.updateSystemConfigs(a)}).catch(a=>{console.error(a),c.value=w(a),r("Error updating config!")})}async function I(e){const a=i.value.map(t=>k(t,e));return new Promise((t,p)=>{Promise.all(a).then(z=>{const b={};u.value.forEach((B,x)=>{const E=B.key;b[E]=z[x]}),t(b)})})}async function V(){return new Promise((e,a)=>{n.list("system_configs",{},{path:"latest"}).then(t=>{const p=t.record;e(p)}).catch(t=>{a(t)})})}return P(async()=>{await V().then(e=>{e?I(e).then(a=>{s.value=a}):s.value=F()}).catch(e=>{console.error(e),r("Error loading config!")})}),(e,a)=>(g(),T("div",R,[s.value?(g(),$(L,{key:0,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value=t),"fields-layout":C,"data-fields":v(i),schemas:o.value,"error-messages":c.value,submittable:!1},null,8,["modelValue","data-fields","schemas","error-messages"])):A("",!0),K("div",Z,[O(v(q),{class:"button",value:"Update",icon:"fa-solid fa-check",onClick:a[1]||(a[1]=t=>D())})])]))}},ee=U(G,[["__scopeId","data-v-dcc9a3e8"]]);export{ee as default};
