import{B as Te,c as k,_ as _e,u as pe,v as ve,j as he,a as ye,a0 as Ke,k as we,r as y,w as Fe,o as be,b as De,d as o,e as d,n as l,i as t,X as W,A as q,J as z,f as v,y as x,F as le,g as ie,h as Z,E as ke,p as Se,m as Le,x as se,D as Me}from"./index-66a5b31b.js";import{_ as me,D as Ve}from"./DataPage-37341d35.js";import{T as Ae}from"./TabContainer-f2954ca9.js";import{u as Ne}from"./input-9eecffb4.js";import"./errors-ebd9927f.js";import"./DataForm-b4a5c72d.js";const{isEmpty:Ie,notEarlierThan:Be}=Te();function fe(){const p=[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"startTime",type:"datetime",label:"Start Time",defaultValue:()=>new Date,listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"endTime",type:"datetime",label:"End Time",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"description",type:"text",label:"Description",defaultValue:()=>"New Task",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"content",type:"textarea",label:"Content",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"tags",type:"multiSelect",label:"Tags",reference:{label:D},listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tags",value:J,label:D}}],C=[{startTime:"md",endTime:"md"},{description:"lg"},{content:"lg"},{tags:"lg"}],M={initData:{startTime:{startTime:null,endTime:null},endTime:{startTime:null,endTime:null}},layout:[{tags:"md"},{startTime:"md"},{endTime:"md"}]},K={create:{endTime:[V]},update:{endTime:[V]}};function J(n){return n.id}function D(n){return`${n.category}:${n.name}`}function V(n){return Be(n,"endTime","startTime")}function A(n){if(n===0)return"0 h 0 m 0 s";const m=Math.floor(n/1e3/60/60/24),g=m*1e3*60*60*24,h=Math.floor((n-g)/1e3/60/60),$=h*1e3*60*60,w=Math.floor((n-g-$)/1e3/60),T=w*1e3*60,S=Math.floor((n-g-$-T)/1e3),i=[];return m>0&&i.push(`${m} d`),h>0&&i.push(`${h} h`),w>0&&i.push(`${w} m`),S>0&&i.push(`${S} s`),i.join(" ")}function N(n){return Ie(n.endTime)?new Date-new Date(n.startTime):new Date(n.endTime)-new Date(n.startTime)}const O=k(()=>p.filter(n=>n.reference)),f=k(()=>O.value.map(n=>n.key));return{dataFields:p,fieldsLayout:C,filters:M,validations:K,formatDuration:A,calculateDuration:N,includeKeys:f,recordValue:J,tagLabel:D}}const Oe=p=>(Se("data-v-1e75295e"),p=p(),Le(),p),Qe={class:"today-logs-container"},je={class:"controls"},He=["onKeydown"],qe=["onKeydown"],ze=["onKeydown"],Ue=["onKeydown"],Pe=["onKeydown"],Ge={class:"logs"},Je={class:"total"},Xe=Oe(()=>l("div",{class:"divider"},null,-1)),Ye={class:"duration"},Re={class:"start-time"},Ze={key:0,class:"end-time"},et={key:1,class:"elapsed"},tt={key:2,class:"elapsed"},at={class:"description"},st={__name:"TodayLog",setup(p){const{isEmpty:C,notEmpty:M}=Te(),K=pe(),D=ve().getSystemConfigs(),{formatShortTime:V}=ke(),{dataFields:A,fieldsLayout:N,validations:O,formatDuration:f,calculateDuration:n,includeKeys:m}=fe(),{formatDataFields:g,validateParams:h,formatDataForShow:$,formatDataForSave:w}=Ne(A),{flashMessage:T}=he(),S=ye(),i=Ke(),I=we(),_=y([]),U=k(()=>A.map(e=>e.key)),L=y({}),X=k(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}),ee=k(()=>{const e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e}),P=y([]),Q=k(()=>P.value.length===0?!1:C(L.value.endTime)&&r.value),ne=k(()=>P.value.reduce((e,u)=>e+u.duration,0));function oe(e){return e.map(u=>(u.duration=n(u),u))}function Y(e){return C(e)?{}:(e.duration=n(e),e)}const b=y(!1),r=y(!1);function a(){return A.reduce((e,u)=>{const c=u.key,F=u.defaultValue;return M(F)?e[c]=F():e[c]=null,e},{})}function s(){L.value=a(),R.value="",b.value=!0}async function E(){L.value=a(),R.value="",await G(L.value)}function j(){b.value=!1}async function G(e){const u=h(O.create,e);if(Object.keys(u).length>0){T("Error submitting task!");return}const c=w(e);await K.create("work_logs",c).then(F=>{T("Started task successfully!"),re(),j()}).catch(F=>{I.error("Error creating data",F),T("Error creating data!")})}const H=y(!1),R=y(""),B=y({});Fe(H,(e,u)=>{e||(B.value={})});async function Ee(e){const u=h(O.update,e);if(Object.keys(u).length>0){T("Error submitting task!");return}const c=w(e);await K.update("work_logs",e.id,c).then(F=>{T("Ended task successfully!"),re(),We(),R.value==="quick"?E():R.value==="input"&&setTimeout(s,1e3)}).catch(F=>{I.error("Error submitting task",F),T("Error submitting task!")})}async function te(){B.value=Object.assign({},L.value),await $("startTime",B.value).then(e=>{B.value.startTime=e}),await $("tags",B.value).then(e=>{B.value.tags=e}),B.value.endTime=new Date,H.value=!0}function ue(){te(),R.value="input"}function de(){te(),R.value="quick"}function We(){B.value={},H.value=!1}const ce=y(!1),ae=k(()=>ce.value?"shortcut show":"shortcut hide");i.registerListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask",invoke:e=>{s()}}),i.registerListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask",invoke:e=>{E()}}),i.registerListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask",invoke:e=>{te()}}),i.registerListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask",invoke:e=>{ue()}}),i.registerListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask",invoke:e=>{de()}}),i.registerListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs",invoke:e=>{b.value&&(b.value=!1),H.value&&(H.value=!1)}});function xe(){i.unregisterListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask"}),i.unregisterListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask"}),i.unregisterListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask"}),i.unregisterListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask"}),i.unregisterListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask"}),i.unregisterListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs"})}S.registerListener("loadTodayLogs",{id:"TodayLog",invoke:e=>{re()}}),S.registerListener("toggleShortcut",{id:"ToggleTodayLogShortcut",invoke:e=>{ce.value=!ce.value}});function Ce(){S.unregisterListener("loadTodayLogs",{id:"TodayLog"}),S.unregisterListener("toggleShortcut",{id:"ToggleTodayLogShortcut"})}async function $e(){await K.schemas("work_logs").then(e=>{const u=e.fields;_.value=g(u)}).catch(e=>{T("Error loading schemas!"),I.error("Error loading schemas",e)})}async function re(){const e={include:m.value,filters:{startTime:{startDate:X.value,endDate:ee.value}},sort:{field:"startTime",order:"desc"}};await K.list("work_logs",e).then(u=>{P.value=oe(u.data),L.value=Y(P.value[0]),M(L.value.startTime)&&(r.value=!0)}).catch(u=>{T("Error loading work logs!"),I.error("Error loading work logs",u)})}return be(async()=>{await re(),await $e()}),De(()=>{Ce(),xe()}),(e,u)=>(o(),d("div",Qe,[l("div",je,[t(Q)?v("",!0):(o(),d("div",{key:0,class:"button",tabindex:"0",onClick:s,onKeydown:W(s,["enter"])},[q(" Start New Task "),l("div",{class:z(t(ae))}," N ",2)],40,He)),t(Q)?v("",!0):(o(),d("div",{key:1,class:"button",tabindex:"0",onClick:E,onKeydown:W(E,["enter"])},[q(" Quick Start New Task "),l("div",{class:z(t(ae))}," Q ",2)],40,qe)),t(Q)?(o(),d("div",{key:2,class:"button",tabindex:"0",onClick:te,onKeydown:W(te,["enter"])},[q(" End Current Task "),l("div",{class:z(t(ae))}," E ",2)],40,ze)):v("",!0),t(Q)?(o(),d("div",{key:3,class:"button",tabindex:"0",onClick:ue,onKeydown:W(ue,["enter"])},[q(" End and Start New "),l("div",{class:z(t(ae))}," G ",2)],40,Ue)):v("",!0),t(Q)?(o(),d("div",{key:4,class:"button",tabindex:"0",onClick:de,onKeydown:W(de,["enter"])},[q(" End and Quick Start "),l("div",{class:z(t(ae))}," F ",2)],40,Pe)):v("",!0)]),l("div",Ge,[l("div",Je," Today's total: "+x(t(f)(t(ne))),1),(o(!0),d(le,null,ie(P.value,(c,F)=>(o(),d("div",{key:F,class:"log"},[Xe,l("div",Ye,[l("div",Re,x(t(V)(c.startTime,t(D).timezone)),1),t(M)(c.endTime)?(o(),d("div",Ze," to "+x(t(V)(c.endTime,t(D).timezone)),1)):v("",!0),t(M)(c.endTime)?(o(),d("div",et," ("+x(t(f)(c.duration))+") ",1)):v("",!0),t(C)(c.endTime)?(o(),d("div",tt," (not ended) ")):v("",!0)]),l("div",at,x(c.description),1)]))),128))]),b.value?(o(),Z(me,{key:0,modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=c=>b.value=c),schemas:_.value,"fields-layout":t(N),"data-fields":t(U),data:L.value,fullscreen:!0,"dialog-title":"Start Task",onSubmit:G},null,8,["modelValue","schemas","fields-layout","data-fields","data"])):v("",!0),H.value?(o(),Z(me,{key:1,modelValue:H.value,"onUpdate:modelValue":u[1]||(u[1]=c=>H.value=c),schemas:_.value,"fields-layout":t(N),"data-fields":t(U),data:B.value,fullscreen:!0,"dialog-title":"End Task",onSubmit:Ee},null,8,["modelValue","schemas","fields-layout","data-fields","data"])):v("",!0)]))}},nt=_e(st,[["__scopeId","data-v-1e75295e"]]);const ge=p=>(Se("data-v-779c309f"),p=p(),Le(),p),ot={class:"weekly-tab-container"},rt={class:"weekly-tabs"},lt=["onKeydown"],it=ge(()=>l("i",{class:"fa-solid fa-angle-left"},null,-1)),ut=["onKeydown"],dt=["onKeydown"],ct=ge(()=>l("i",{class:"fa-solid fa-angle-right"},null,-1)),vt={class:"weekly-tab-content"},yt={key:0,class:"total"},kt={key:1,class:"total"},ft={class:"timeline"},gt=ge(()=>l("div",{class:"divider"},null,-1)),mt={class:"heading"},Tt={class:"date"},_t={key:0,class:"duration"},pt={key:1,class:"duration"},ht={class:"entries"},wt={key:0},bt={class:"description"},Dt={class:"duration"},St={__name:"WeekLog",props:{loadData:{type:Boolean,default:!1}},setup(p){const C=pe(),K=ve().getSystemConfigs(),{formatLongDate:J}=ke(),{formatDuration:D,calculateDuration:V}=fe(),{flashMessage:A}=he(),N=ye(),O=we(),f=y("this"),n=y({}),m=y(0),g=y("prevWeekTab"),h=y("thisWeekTab"),$=y("nextWeekTab"),w=k(()=>{const r=new Date,a=new Date,s=m.value*7;return f.value==="prev"?(a.setDate(a.getDate()+s),a.setDate(a.getDate()-r.getDay())):(f.value==="next"&&a.setDate(a.getDate()+s),a.setDate(a.getDate()-r.getDay())),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a}),T=k(()=>{const r=new Date;return r.setDate(w.value.getDate()+6),r.setHours(23),r.setMinutes(59),r.setSeconds(59),r}),S=k(()=>Array.from(Array(7)).map((r,a)=>{const s=new Date(w.value);return s.setDate(w.value.getDate()+a),s.setHours(0),s.setMinutes(0),s.setSeconds(0),s})),i=k(()=>({startTime:{startDate:w.value,endDate:T.value}})),I=k(()=>Object.entries(n.value).reduce((r,[a,{total:s}])=>r+s,0));function _(r){return n.value[r]?n.value[r]:{total:0,entries:[]}}function U(r){const a=S.value.reduce((s,E)=>(s[E]={entries:[],total:0},s),{});return r.forEach(s=>{const E=new Date(s.startTime),j=new Date(E.getFullYear(),E.getMonth(),E.getDate(),0,0,0),G=V(s);a[j].entries.push(Object.assign({},s,{duration:G})),a[j].total=a[j].total+G}),a}N.registerListener("loadWeeklyLogs",{id:"WeekLog",invoke:r=>{b()}});function L(){N.unregisterListener("loadWeeklyLogs",{id:"WeekLog"})}const X=k(()=>f.value==="prev"?"weekly-tab active":"weekly-tab"),ee=k(()=>f.value==="this"?"weekly-tab active":"weekly-tab"),P=k(()=>f.value==="next"?"weekly-tab active":"weekly-tab");async function Q(){m.value=m.value-1,f.value="prev",g.value.blur(),await b()}async function ne(){m.value=0,f.value="this",h.value.blur(),await b()}async function oe(){m.value=m.value+1,f.value="next",$.value.blur(),await b()}function Y(r){r==="prev"?g.value.focus():r==="next"?$.value.focus():h.value.focus()}async function b(){const r={filters:i.value};await C.list("work_logs",r).then(a=>{n.value=U(a.data)}).catch(a=>{A("Error loading work logs!"),O.error("Error loading work logs",a)})}return be(async()=>{await b()}),De(()=>{L()}),(r,a)=>(o(),d("div",ot,[l("div",rt,[l("div",{ref_key:"prevWeekTab",ref:g,class:z(t(X)),tabindex:"0",onClick:Q,onKeydown:[W(Q,["enter"]),a[0]||(a[0]=W(s=>Y("this"),["arrow-right"]))]},[it,q(" Prev Week ")],42,lt),l("div",{ref_key:"thisWeekTab",ref:h,class:z(t(ee)),tabindex:"0",onClick:ne,onKeydown:[W(ne,["enter"]),a[1]||(a[1]=W(s=>Y("prev"),["arrow-left"])),a[2]||(a[2]=W(s=>Y("next"),["arrow-right"]))]}," This Week ",42,ut),l("div",{ref_key:"nextWeekTab",ref:$,class:z(t(P)),tabindex:"0",onClick:oe,onKeydown:[W(oe,["enter"]),a[3]||(a[3]=W(s=>Y("this"),["arrow-left"]))]},[q(" Next Week "),ct],42,dt)]),l("div",vt,[t(I)>0?(o(),d("div",yt," Week's total: "+x(t(D)(t(I))),1)):v("",!0),t(I)===0?(o(),d("div",kt," Week's total: 0 h 0 m 0 s ")):v("",!0),l("div",ft,[(o(!0),d(le,null,ie(t(S),(s,E)=>(o(),d("div",{key:E,class:"day"},[gt,l("div",mt,[l("div",Tt,x(t(J)(s,t(K).timezone)),1),_(s).total>0?(o(),d("div",_t," ("+x(t(D)(_(s).total))+") ",1)):v("",!0),_(s).total===0?(o(),d("div",pt," (0 h 0 m 0 s) ")):v("",!0)]),l("div",ht,[_(s).entries.length===0?(o(),d("div",wt," No entry ")):v("",!0),(o(!0),d(le,null,ie(_(s).entries,(j,G)=>(o(),d("div",{key:G,class:"entry"},[l("div",bt,x(j.description),1),l("div",Dt,x(t(D)(j.duration)),1)]))),128))])]))),128))])])]))}},Lt=_e(St,[["__scopeId","data-v-779c309f"]]),Ft={__name:"WorkLogs",setup(p){const C=ye(),{formatTagSync:M,tagStyle:K}=ke(),D=ve().getSystemConfigs(),{dataFields:V,fieldsLayout:A,filters:N,validations:O,formatDuration:f,calculateDuration:n}=fe(),m={oneline:!0,showHeader:!1,highlightField:"description"},g=y(0),h=[{label:"Today",onchange:$},{label:"Weekly",onchange:w},{label:"All Logs",onchange:T}];function $(){C.emitEvent("loadTodayLogs",{})}function w(){C.emitEvent("loadWeeklyLogs",{})}function T(){C.emitEvent("loadData",{dataType:"Work Logs"})}async function S(i){await h[i].onchange(),g.value=i}return(i,I)=>(o(),Z(Ae,{tabs:h,"selected-tab":g.value,onTabChange:S},{"tab-0":se(()=>[g.value===0?(o(),Z(nt,{key:0})):v("",!0)]),"tab-1":se(()=>[g.value===1?(o(),Z(Lt,{key:0})):v("",!0)]),"tab-2":se(()=>[g.value===2?(o(),Z(Ve,{key:0,"model-class":"work_logs","data-type":"Work Logs",fullscreen:!0,"fields-layout":t(A),"data-fields":t(V),validations:t(O),filters:t(N),"table-style":m},{["data-col.startTime"]:se(({row:_})=>[q(" Total duration "),l("strong",null,x(t(f)(t(n)(_))),1)]),["data-col.tags"]:se(({row:_,key:U,rawValue:L})=>[(o(!0),d(le,null,ie(L,(X,ee)=>(o(),d("span",{key:ee,class:"tag inline",style:Me(t(K)(_,X,U))},x(t(M)(_,X,U,t(D).tagFormat)),5))),128))]),_:2},1032,["fields-layout","data-fields","validations","filters"])):v("",!0)]),_:1},8,["selected-tab"]))}};export{Ft as default};
