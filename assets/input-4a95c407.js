import{u as je,y as Fe,a as De,c as m,B as de,a8 as ke}from"./index-affc3919.js";function Ee(d){const k=je(),{formatDate:q,formatTimestamp:G}=de(),{isEmpty:y,notEmpty:p}=Fe(),{base64ToFile:K}=ke(),v=De(),l=m(()=>d.reduce((e,t)=>(e[t.key]=t,e),{})),S=m(()=>Object.values(l.value).filter(e=>e.listable)),Q=m(()=>S.value.map(e=>e.key)),T=m(()=>Object.values(l.value).filter(e=>e.viewable)),R=m(()=>T.value.map(e=>e.key)),V=m(()=>Object.values(l.value).filter(e=>e.creatable)),W=m(()=>V.value.map(e=>e.key)),P=m(()=>Object.values(l.value).filter(e=>e.updatable)),X=m(()=>P.value.map(e=>e.key)),A=m(()=>Object.values(l.value).filter(e=>e.sortable)),Y=m(()=>A.value.map(e=>e.key)),Z=m(()=>Object.values(l.value).some(e=>e.type==="file")),I=m(()=>Object.keys(l.value).filter(e=>F(e))),w=m(()=>Object.keys(l.value).filter(e=>J(e))),_=m(()=>Object.keys(l.value).filter(e=>D(e))),x=m(()=>Object.keys(l.value).filter(e=>g(e))),C=m(()=>Object.keys(l.value).filter(e=>O(e))),ee=m(()=>Object.keys(l.value).filter(e=>N(e))),te=m(()=>Object.keys(l.value).filter(e=>B(e))),L=m(()=>Object.keys(l.value).filter(e=>E(e))),M=m(()=>Object.keys(l.value).filter(e=>H(e))),z=m(()=>Object.keys(l.value).filter(e=>j(e))),ne=m(()=>d.filter(e=>e.reference||e.file)),ae=m(()=>ne.value.map(e=>e.key));function o(e){return(l.value[e]||{}).type}function re(e){return(l.value[e]||{}).label}function se(e,t,n,a,r){const i=n.find(s=>s===e),u=t[e];if(!y(u))if(p(i)&&!j(e)){const s=t.includes||{},f=[u].flat().filter(b=>!!b).map(b=>{if(y(s[e]))return b;const h=s[e][b];return y(h)?b:l.value[e].reference.label(h)});return g(e)?f:f[0]}else{if(o(e)==="enum"||o(e)==="select")return a.find(f=>f.key===e).options.find(f=>f.value===u).label;if(o(e)==="datetime")return G(u,r.timezone);if(o(e)==="date")return q(u,r.timezone);if(j(e)){const s=t.includes||{};if(y(s[e]))return;const c=s[e][u];return y(c)?void 0:c.rawData}else return u}}function ue(e){return o(e)==="text"||o(e)==="number"}function le(e){return o(e)==="textarea"}function g(e){return o(e)==="multiSelect"}function O(e){return o(e)==="singleSelect"}function F(e){return o(e)==="select"||o(e)==="enum"}function D(e){return o(e)==="select"||o(e)==="multiSelect"||o(e)==="singleSelect"||o(e)==="enum"}function J(e){return D(e)&&l.value[e].options&&l.value[e].options.server}function N(e){return l.value[e].nullToggleable}function B(e){return e==="tags"||Object.is(l.value[e].isTags,!0)}function E(e){return o(e)==="object"}function H(e){return o(e)==="number"}function j(e){return o(e)==="file"}function U(e,t,n,a){return Object.assign({},{loading:!1,pagination:{offset:t,limit:n,client:!1}},a)}function ce(e){return d.map(t=>{if(t.type==="enum"){const n=e[t.key].enums,a=Object.keys(n).map(i=>({value:i,label:n[i]}));return Object.assign({},t,{options:a})}else return t})}function oe(e,t){return Object.keys(e).reduce((n,a)=>{const i=e[a].map(u=>u(t)).filter(u=>!!u);return i.length>0&&(n[a]=i),n},{})}async function ie(e,t){return k.view(e,t,{})}async function me(e,t){const n=l.value[e].options,a=n.modelClass,r=t.map(i=>ie(a,i));return new Promise((i,u)=>{Promise.all(r).then(s=>{const c=s.map(f=>{const b=n.value(f),h=n.label(f);return{value:b,label:h}});i(c)}).catch(s=>{v.error("Error loading includes from server",s),u(s)})})}function fe(e,t){const n=t[e];if(p(n))return n;const a=l.value[e].defaultValue;return p(a)?a():n}async function pe(e,t){return new Promise((n,a)=>{const r=fe(e,t);if(y(r)){n(r);return}if(E(e)){n(JSON.stringify(r,!1,4));return}if(j(e)){const u=l.value[e].file;if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];K(s.rawData,s.filename,s.mimeType).then(c=>{n(c)}).catch(c=>{v.error("Error converting base64 to file",{error:c}),n(null)})}else k.view(u.modelClass,r,{}).then(s=>{K(s.rawData,s.filename,s.mimeType).then(c=>{y(t.includes)&&(t.includes={}),y(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,n(c)}).catch(c=>{v.error("Error converting base64 to file",{error:c}),n(null)})}).catch(s=>{v.error("Error formatting data for show",s),n(null)});return}if(o(e)!=="date"&&o(e)!=="datetime"&&!g(e)&&!O(e)){n(r);return}if(o(e)==="date"||o(e)==="datetime"){let u;r instanceof Date||typeof r=="string"?u=new Date(r):u=Object.entries(r).reduce((s,[c,f])=>(p(f)?s[c]=new Date(f):s[c]=f,s),{}),n(u);return}const i=[r].flat();if((O(e)||g(e))&&Array.isArray(l.value[e].options)){const u=l.value[e].options,s=i.map(c=>{const f=u.find(b=>b.value===c);return{value:f.value,label:f.label}});n(s);return}if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const u=t.includes[e],s=i.map(c=>{const f=u[c],b=l.value[e].options,h=b.value(f),he=b.label(f);return{value:h,label:he}});n(s)}else me(e,i).then(u=>{n(u)}).catch(u=>{v.error("Error formatting data for show",u);const s=[];i.forEach(c=>{p(c)&&s.push({value:c,label:c})}),n(s)})})}function be(e){const t=Object.assign({},e);return x.value.forEach(a=>{const r=t[a]||[];t[a]=r.map(i=>i.value)}),C.value.forEach(a=>{const r=t[a]||[];t[a]=(r[0]||{}).value||""}),I.value.forEach(a=>{const r=t[a];(y(r)||r.length===0)&&(t[a]="")}),L.value.forEach(a=>{p(t[a])&&t[a].length>0?t[a]=JSON.parse(t[a]):t[a]={}}),z.value.forEach(a=>{const r=t[a];y(r)&&(t[a]="")}),M.value.forEach(a=>{const r=t[a];p(r)&&(t[a]=parseFloat(r))}),Object.entries(t).reduce((a,[r,i])=>(Object.is(i,void 0)?a[r]=null:a[r]=i,a),{})}function ye(e){return Object.entries(e).reduce((t,[n,a])=>(t[n]=a.map(r=>({name:r,params:{}})),t),{})}function ge(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)?t[n]=a:F(n)&&a.length>0?t[n]=a[0].value:(g(n)||O(n))&&a.length>0?t[n]=a.map(r=>r.value):t[n]=a,t),{})}function ve(e={}){return Object.entries(e).reduce((t,[n,a])=>(y(a)||(F(n)||D(n))&&a.length===0||(O(n)&&a.length>0?t[n]=a[0].value:g(n)&&a.length>0?t[n]=a.map(r=>r.value):o(n)==="date"?(p(a.startDate)&&(t[n]={},t[n].startDate=a.startDate),p(a.endDate)&&(y(t[n])&&(t[n]={}),t[n].endDate=a.endDate)):o(n)==="datetime"?(p(a.startTime)&&(t[n]={},t[n].startTime=a.startTime),p(a.endTime)&&(y(t[n])&&(t[n]={}),t[n].endTime=a.endTime)):t[n]=a),t),{})}async function $(e,t){const n=l.value[e].options;if(n.server){const a=n.limit||5;return new Promise((r,i)=>{k.list(n.modelClass,{offset:t,limit:a}).then(u=>{const s=u.data,f={total:u.total,data:s.map(b=>({value:n.value(b),label:n.label(b)}))};r(U(e,t,a,f))}).catch(u=>{v.error(`Error fetching options for field ${e}`,u),r({data:[],total:0,loading:!1,pagination:{offset:0,limit:5,client:!1}})})})}else return new Promise((a,r)=>{a(Object.assign({},{data:n,total:n.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function Oe(){return new Promise((e,t)=>{Promise.all(w.value.map(n=>{const a=l.value[n].offset||0;return $(n,a)})).then(n=>{const a={};n.forEach((r,i)=>{const u=w.value[i];a[u]=r}),e(a)})})}return{schemasMap:l,listableFields:S,listableKeys:Q,viewableFields:T,viewableKeys:R,creatableFields:V,creatableKeys:W,updatableFields:P,updatableKeys:X,sortableFields:A,sortableKeys:Y,multipartData:Z,clientOptionsKeys:I,clientOptionsField:F,serverOptionsKeys:w,serverOptionsField:J,selectableKeys:_,multiSelectableKeys:x,singleSelectableKeys:C,inputType:o,inputLabel:re,inputValue:se,inputableField:ue,multiInputableField:le,multiSelectableField:g,singleSelectableField:O,selectableField:D,nullToggleableField:N,nullToggleableKeys:ee,tagsField:B,tagsKeys:te,objectField:E,objectKeys:L,numberField:H,numberKeys:M,fileField:j,fileKeys:z,includeKeys:ae,formatInputOptionsData:U,formatDataFields:ce,formatDataForShow:pe,formatDataForSave:be,formatErrorsForDisplay:ye,formatFiltersForShow:ge,formatFiltersForLoad:ve,validateParams:oe,fetchOptions:$,initOptionsData:Oe}}export{Ee as u};
