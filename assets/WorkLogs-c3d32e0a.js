import{A as Te,c as y,_ as pe,u as he,t as ce,i as be,a as ve,a0 as Ce,j as we,r as v,w as $e,o as De,b as r,d as u,m as l,h as t,W as E,y as H,I as Q,e as f,x as W,F as re,f as le,n as me,D as ye,p as Se,l as Le,g as oe,v as te,B as Ke}from"./index-e6af60f1.js";import{_ as _e,D as Ve}from"./DataPage-3e2d1a47.js";import{T as Fe}from"./TabContainer-87eb167d.js";import{u as Me}from"./input-985afb35.js";import"./errors-ebd9927f.js";import"./DataForm-5e21e373.js";const{isEmpty:Ne,notEarlierThan:Ae}=Te();function fe(){const p=[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"startTime",type:"datetime",label:"Start Time",defaultValue:()=>new Date,listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"endTime",type:"datetime",label:"End Time",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"description",type:"text",label:"Description",defaultValue:()=>"New Task",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"content",type:"textarea",label:"Content",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"tags",type:"multiSelect",label:"Tags",reference:{label:D},listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tags",value:P,label:D}}],x=[{startTime:"md",endTime:"md"},{description:"lg"},{content:"lg"},{tags:"lg"}],F={initData:{startTime:{startTime:null,endTime:null},endTime:{startTime:null,endTime:null}},layout:[{tags:"md"},{startTime:"md"},{endTime:"md"}]},K={create:{endTime:[M]},update:{endTime:[M]}};function P(s){return s.id}function D(s){return`${s.category}:${s.name}`}function M(s){return Ae(s,"endTime","startTime")}function N(s){if(s===0)return"0 h 0 m 0 s";const m=Math.floor(s/1e3/60/60/24),g=m*1e3*60*60*24,h=Math.floor((s-g)/1e3/60/60),C=h*1e3*60*60,b=Math.floor((s-g-C)/1e3/60),_=b*1e3*60,V=Math.floor((s-g-C-_)/1e3),c=[];return m>0&&c.push(`${m} d`),h>0&&c.push(`${h} h`),b>0&&c.push(`${b} m`),V>0&&c.push(`${V} s`),c.join(" ")}function I(s){return Ne(s.endTime)?new Date-new Date(s.startTime):new Date(s.endTime)-new Date(s.startTime)}const O=y(()=>p.filter(s=>s.reference)),k=y(()=>O.value.map(s=>s.key));return{dataFields:p,fieldsLayout:x,filters:F,validations:K,formatDuration:N,calculateDuration:I,includeKeys:k,recordValue:P,tagLabel:D}}const Ie=p=>(Se("data-v-977636d7"),p=p(),Le(),p),Oe={class:"today-logs-container"},je={class:"controls"},Be=["onKeydown"],He=["onKeydown"],Qe=["onKeydown"],ze=["onKeydown"],qe=["onKeydown"],Ue={class:"logs"},Pe={class:"total"},Ge=Ie(()=>l("div",{class:"divider"},null,-1)),Ye={class:"duration"},Je={class:"start-time"},Re={key:0,class:"end-time"},Xe={key:1,class:"elapsed"},Ze={key:2,class:"elapsed"},et={class:"description"},tt={__name:"TodayLog",setup(p){const{isEmpty:x,notEmpty:F}=Te(),K=he(),D=ce().getSystemConfigs(),{formatShortTime:M}=ye(),{dataFields:N,fieldsLayout:I,validations:O,formatDuration:k,calculateDuration:s,includeKeys:m}=fe(),{formatDataFields:g,validateParams:h,formatDataForShow:C,formatDataForSave:b}=Me(N),{flashMessage:_}=be(),V=ve(),c=Ce(),A=we(),T=v([]),z=y(()=>N.map(e=>e.key)),w=v({}),G=y(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}),X=y(()=>{const e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e}),j=v([]),B=y(()=>j.value.length===0?!1:x(w.value.endTime)&&a.value),ae=y(()=>j.value.reduce((e,i)=>e+i.duration,0));function Y(e){return e.map(i=>(i.duration=s(i),i))}function q(e){return x(e)?{}:(e.duration=s(e),e)}const n=v(!1),a=v(!1);function o(){return N.reduce((e,i)=>{const d=i.key,ne=i.defaultValue;return F(ne)?e[d]=ne():e[d]=null,e},{})}function S(){w.value=o(),R.value="",n.value=!0}async function $(){w.value=o(),R.value="",await ge()}function J(){n.value=!1}async function ge(){const e=h(O.create,w.value);if(Object.keys(e).length>0){_("Error submitting task!");return}const i=b(w.value);await K.create("work_logs",i).then(d=>{_("Started task successfully!"),se(),J()}).catch(d=>{A.error("Error creating data",d),_("Error creating data!")})}const U=v(!1),R=v(""),L=v({});$e(U,(e,i)=>{e||(L.value={})});async function Ee(){const e=h(O.update,L.value);if(Object.keys(e).length>0){_("Error submitting task!");return}const i=b(L.value);await K.update("work_logs",L.value.id,i).then(d=>{_("Ended task successfully!"),se(),We(),R.value==="quick"?$():R.value==="input"&&setTimeout(S,1e3)}).catch(d=>{A.error("Error submitting task",d),_("Error submitting task!")})}async function Z(){L.value=Object.assign({},w.value),await C("startTime",L.value).then(e=>{L.value.startTime=e}),await C("tags",L.value).then(e=>{L.value.tags=e}),L.value.endTime=new Date,U.value=!0}function ie(){Z(),R.value="input"}function ue(){Z(),R.value="quick"}function We(){L.value={},U.value=!1}const de=v(!1),ee=y(()=>de.value?"shortcut show":"shortcut hide");c.registerListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask",invoke:e=>{S()}}),c.registerListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask",invoke:e=>{$()}}),c.registerListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask",invoke:e=>{Z()}}),c.registerListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask",invoke:e=>{ie()}}),c.registerListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask",invoke:e=>{ue()}}),c.registerListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs",invoke:e=>{n.value&&(n.value=!1),U.value&&(U.value=!1)}}),V.registerListener("loadTodayLogs",{id:"TodayLog",invoke:e=>{se()}}),V.registerListener("toggleShortcut",{id:"ToggleTodayLogShortcut",invoke:e=>{de.value=!de.value}});async function xe(){await K.schemas("work_logs").then(e=>{const i=e.fields;T.value=g(i)}).catch(e=>{_("Error loading schemas!"),A.error("Error loading schemas",e)})}async function se(){const e={include:m.value,filters:{startTime:{startDate:G.value,endDate:X.value}},sort:{field:"startTime",order:"desc"}};await K.list("work_logs",e).then(i=>{j.value=Y(i.data),w.value=q(j.value[0]),F(w.value.startTime)&&(a.value=!0)}).catch(i=>{_("Error loading work logs!"),A.error("Error loading work logs",i)})}return De(async()=>{await se(),await xe()}),(e,i)=>(r(),u("div",Oe,[l("div",je,[t(B)?f("",!0):(r(),u("div",{key:0,class:"button",tabindex:"0",onClick:S,onKeydown:E(S,["enter"])},[H(" Start New Task "),l("div",{class:Q(t(ee))}," N ",2)],40,Be)),t(B)?f("",!0):(r(),u("div",{key:1,class:"button",tabindex:"0",onClick:$,onKeydown:E($,["enter"])},[H(" Quick Start New Task "),l("div",{class:Q(t(ee))}," Q ",2)],40,He)),t(B)?(r(),u("div",{key:2,class:"button",tabindex:"0",onClick:Z,onKeydown:E(Z,["enter"])},[H(" End Current Task "),l("div",{class:Q(t(ee))}," E ",2)],40,Qe)):f("",!0),t(B)?(r(),u("div",{key:3,class:"button",tabindex:"0",onClick:ie,onKeydown:E(ie,["enter"])},[H(" End and Start New "),l("div",{class:Q(t(ee))}," G ",2)],40,ze)):f("",!0),t(B)?(r(),u("div",{key:4,class:"button",tabindex:"0",onClick:ue,onKeydown:E(ue,["enter"])},[H(" End and Quick Start "),l("div",{class:Q(t(ee))}," F ",2)],40,qe)):f("",!0)]),l("div",Ue,[l("div",Pe," Today's total: "+W(t(k)(t(ae))),1),(r(!0),u(re,null,le(j.value,(d,ne)=>(r(),u("div",{key:ne,class:"log"},[Ge,l("div",Ye,[l("div",Je,W(t(M)(d.startTime,t(D).timezone)),1),t(F)(d.endTime)?(r(),u("div",Re," to "+W(t(M)(d.endTime,t(D).timezone)),1)):f("",!0),t(F)(d.endTime)?(r(),u("div",Xe," ("+W(t(k)(d.duration))+") ",1)):f("",!0),t(x)(d.endTime)?(r(),u("div",Ze," (not ended) ")):f("",!0)]),l("div",et,W(d.description),1)]))),128))]),me(_e,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=d=>n.value=d),schemas:T.value,"fields-layout":t(I),"data-fields":t(z),data:w.value,fullscreen:!0,"dialog-title":"Start Task",onSubmit:ge},null,8,["modelValue","schemas","fields-layout","data-fields","data"]),me(_e,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=d=>U.value=d),schemas:T.value,"fields-layout":t(I),"data-fields":t(z),data:L.value,fullscreen:!0,"dialog-title":"End Task",onSubmit:Ee},null,8,["modelValue","schemas","fields-layout","data-fields","data"])]))}},at=pe(tt,[["__scopeId","data-v-977636d7"]]);const ke=p=>(Se("data-v-139396c0"),p=p(),Le(),p),st={class:"weekly-tab-container"},nt={class:"weekly-tabs"},ot=["onKeydown"],rt=ke(()=>l("i",{class:"fa-solid fa-angle-left"},null,-1)),lt=["onKeydown"],it=["onKeydown"],ut=ke(()=>l("i",{class:"fa-solid fa-angle-right"},null,-1)),dt={class:"weekly-tab-content"},ct={key:0,class:"total"},vt={key:1,class:"total"},yt={class:"timeline"},ft=ke(()=>l("div",{class:"divider"},null,-1)),kt={class:"heading"},gt={class:"date"},mt={key:0,class:"duration"},_t={key:1,class:"duration"},Tt={class:"entries"},pt={key:0},ht={class:"description"},bt={class:"duration"},wt={__name:"WeekLog",props:{loadData:{type:Boolean,default:!1}},setup(p){const x=he(),K=ce().getSystemConfigs(),{formatLongDate:P}=ye(),{formatDuration:D,calculateDuration:M}=fe(),{flashMessage:N}=be(),I=ve(),O=we(),k=v("this"),s=v({}),m=v(0),g=v("prevWeekTab"),h=v("thisWeekTab"),C=v("nextWeekTab"),b=y(()=>{const n=new Date,a=new Date,o=m.value*7;return k.value==="prev"?(a.setDate(a.getDate()+o),a.setDate(a.getDate()-n.getDay())):(k.value==="next"&&a.setDate(a.getDate()+o),a.setDate(a.getDate()-n.getDay())),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a}),_=y(()=>{const n=new Date;return n.setDate(b.value.getDate()+6),n.setHours(23),n.setMinutes(59),n.setSeconds(59),n}),V=y(()=>Array.from(Array(7)).map((n,a)=>{const o=new Date(b.value);return o.setDate(b.value.getDate()+a),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o})),c=y(()=>({startTime:{startDate:b.value,endDate:_.value}})),A=y(()=>Object.entries(s.value).reduce((n,[a,{total:o}])=>n+o,0));function T(n){return s.value[n]?s.value[n]:{total:0,entries:[]}}function z(n){const a=V.value.reduce((o,S)=>(o[S]={entries:[],total:0},o),{});return n.forEach(o=>{const S=new Date(o.startTime),$=new Date(S.getFullYear(),S.getMonth(),S.getDate(),0,0,0),J=M(o);a[$].entries.push(Object.assign({},o,{duration:J})),a[$].total=a[$].total+J}),a}I.registerListener("loadWeeklyLogs",{id:"WeekLog",invoke:n=>{q()}});const w=y(()=>k.value==="prev"?"weekly-tab active":"weekly-tab"),G=y(()=>k.value==="this"?"weekly-tab active":"weekly-tab"),X=y(()=>k.value==="next"?"weekly-tab active":"weekly-tab");async function j(){m.value=m.value-1,k.value="prev",g.value.blur(),await q()}async function B(){m.value=0,k.value="this",h.value.blur(),await q()}async function ae(){m.value=m.value+1,k.value="next",C.value.blur(),await q()}function Y(n){n==="prev"?g.value.focus():n==="next"?C.value.focus():h.value.focus()}async function q(){const n={filters:c.value};await x.list("work_logs",n).then(a=>{s.value=z(a.data)}).catch(a=>{N("Error loading work logs!"),O.error("Error loading work logs",a)})}return De(async()=>{await q()}),(n,a)=>(r(),u("div",st,[l("div",nt,[l("div",{ref_key:"prevWeekTab",ref:g,class:Q(t(w)),tabindex:"0",onClick:j,onKeydown:[E(j,["enter"]),a[0]||(a[0]=E(o=>Y("this"),["arrow-right"]))]},[rt,H(" Prev Week ")],42,ot),l("div",{ref_key:"thisWeekTab",ref:h,class:Q(t(G)),tabindex:"0",onClick:B,onKeydown:[E(B,["enter"]),a[1]||(a[1]=E(o=>Y("prev"),["arrow-left"])),a[2]||(a[2]=E(o=>Y("next"),["arrow-right"]))]}," This Week ",42,lt),l("div",{ref_key:"nextWeekTab",ref:C,class:Q(t(X)),tabindex:"0",onClick:ae,onKeydown:[E(ae,["enter"]),a[3]||(a[3]=E(o=>Y("this"),["arrow-left"]))]},[H(" Next Week "),ut],42,it)]),l("div",dt,[t(A)>0?(r(),u("div",ct," Week's total: "+W(t(D)(t(A))),1)):f("",!0),t(A)===0?(r(),u("div",vt," Week's total: 0 h 0 m 0 s ")):f("",!0),l("div",yt,[(r(!0),u(re,null,le(t(V),(o,S)=>(r(),u("div",{key:S,class:"day"},[ft,l("div",kt,[l("div",gt,W(t(P)(o,t(K).timezone)),1),T(o).total>0?(r(),u("div",mt," ("+W(t(D)(T(o).total))+") ",1)):f("",!0),T(o).total===0?(r(),u("div",_t," (0 h 0 m 0 s) ")):f("",!0)]),l("div",Tt,[T(o).entries.length===0?(r(),u("div",pt," No entry ")):f("",!0),(r(!0),u(re,null,le(T(o).entries,($,J)=>(r(),u("div",{key:J,class:"entry"},[l("div",ht,W($.description),1),l("div",bt,W(t(D)($.duration)),1)]))),128))])]))),128))])])]))}},Dt=pe(wt,[["__scopeId","data-v-139396c0"]]),$t={__name:"WorkLogs",setup(p){const x=ve(),{formatTagSync:F,tagStyle:K}=ye(),D=ce().getSystemConfigs(),{dataFields:M,fieldsLayout:N,filters:I,validations:O,formatDuration:k,calculateDuration:s}=fe(),m={oneline:!0,showHeader:!1,highlightField:"description"},g=v(0),h=[{label:"Today",onchange:C},{label:"Weekly",onchange:b},{label:"All Logs",onchange:_}];function C(){x.emitEvent("loadTodayLogs",{})}function b(){x.emitEvent("loadWeeklyLogs",{})}function _(){x.emitEvent("loadData",{dataType:"Work Logs"})}async function V(c){await h[c].onchange(),g.value=c}return(c,A)=>(r(),oe(Fe,{tabs:h,"selected-tab":g.value,onTabChange:V},{"tab-0":te(()=>[g.value===0?(r(),oe(at,{key:0})):f("",!0)]),"tab-1":te(()=>[g.value===1?(r(),oe(Dt,{key:0})):f("",!0)]),"tab-2":te(()=>[g.value===2?(r(),oe(Ve,{key:0,"model-class":"work_logs","data-type":"Work Logs",fullscreen:!0,"fields-layout":t(N),"data-fields":t(M),validations:t(O),filters:t(I),"table-style":m},{["data-col.startTime"]:te(({row:T})=>[H(" Total duration "),l("strong",null,W(t(k)(t(s)(T))),1)]),["data-col.tags"]:te(({row:T,key:z,rawValue:w})=>[(r(!0),u(re,null,le(w,(G,X)=>(r(),u("span",{key:X,class:"tag inline",style:Ke(t(K)(T,G,z))},W(t(F)(T,G,z,t(D).tagFormat)),5))),128))]),_:2},1032,["fields-layout","data-fields","validations","filters"])):f("",!0)]),_:1},8,["selected-tab"]))}};export{$t as default};
