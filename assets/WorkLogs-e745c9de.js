import{x as ge,d as f,_ as _e,a as Te,q as pe,u as he,E as ce,Z as $e,b as be,r as v,w as Ce,e as we,o as l,c as u,j as r,h as t,W as E,v as H,J as Q,f as y,t as C,z as ue,B as de,k as ke,D as De,p as Se,i as Ee,g as ae,s as se}from"./index-4aadfbc8.js";import{_ as me,D as Ke}from"./DataPage-b5787fe6.js";import{T as Ve}from"./TabContainer-57afd930.js";import{u as Me}from"./input-f75b7148.js";import"./errors-29306128.js";import"./DataForm-42274987.js";const{isEmpty:Fe,notEarlierThan:Ne}=ge();function ve(){const _=[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"startTime",type:"datetime",label:"Start Time",defaultValue:()=>new Date,listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"endTime",type:"datetime",label:"End Time",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"description",type:"text",label:"Description",defaultValue:()=>"New Task",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"content",type:"textarea",label:"Content",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"tags",type:"multiSelect",label:"Tags",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tags",value:q,label:p}}],L=[{startTime:"md",endTime:"md"},{description:"lg"},{content:"lg"},{tags:"lg"}],V={initData:{startTime:{startTime:null,endTime:null},endTime:{startTime:null,endTime:null}},layout:[{tags:"md"},{startTime:"md"},{endTime:"md"}]},K={create:{endTime:[M]},update:{endTime:[M]}};function q(s){return s.id}function p(s){return`${s.category}:${s.name}`}function M(s){return Ne(s,"endTime","startTime")}function F(s){if(s===0)return"0 h 0 m 0 s";const k=Math.floor(s/1e3/60/60/24),W=k*1e3*60*60*24,b=Math.floor((s-W)/1e3/60/60),T=b*1e3*60*60,w=Math.floor((s-W-T)/1e3/60),m=w*1e3*60,I=Math.floor((s-W-T-m)/1e3),g=[];return k>0&&g.push(`${k} d`),b>0&&g.push(`${b} h`),w>0&&g.push(`${w} m`),I>0&&g.push(`${I} s`),g.join(" ")}function A(s){return Fe(s.endTime)?new Date-new Date(s.startTime):new Date(s.endTime)-new Date(s.startTime)}const h=f(()=>_.filter(s=>s.reference)),c=f(()=>h.value.map(s=>s.key));return{dataFields:_,fieldsLayout:L,filters:V,validations:K,formatDuration:F,calculateDuration:A,includeKeys:c,recordValue:q,tagLabel:p}}const Ae=_=>(Se("data-v-977636d7"),_=_(),Ee(),_),Ie={class:"today-logs-container"},Oe={class:"controls"},je=["onKeydown"],Be=["onKeydown"],He=["onKeydown"],Qe=["onKeydown"],qe=["onKeydown"],ze={class:"logs"},Ue={class:"total"},Pe=Ae(()=>r("div",{class:"divider"},null,-1)),Ge={class:"duration"},Je={class:"start-time"},Ye={key:0,class:"end-time"},Ze={key:1,class:"elapsed"},Re={key:2,class:"elapsed"},Xe={class:"description"},et={__name:"TodayLog",setup(_){const{isEmpty:L,notEmpty:V}=ge(),K=Te(),p=pe().getSystemConfigs(),{formatShortTime:M}=De(),{dataFields:F,fieldsLayout:A,validations:h,formatDuration:c,calculateDuration:s,includeKeys:k}=ve(),{formatDataFields:W,validateParams:b,formatDataForShow:T,formatDataForSave:w}=Me(F),{flashMessage:m}=he(),I=ce(),g=$e(),O=be(),N=v([]),R=f(()=>F.map(e=>e.key)),x=v({}),ne=f(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}),oe=f(()=>{const e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e}),j=v([]),B=f(()=>j.value.length===0?!1:L(x.value.endTime)&&a.value),X=f(()=>j.value.reduce((e,i)=>e+i.duration,0));function P(e){return e.map(i=>(i.duration=s(i),i))}function z(e){return L(e)?{}:(e.duration=s(e),e)}const n=v(!1),a=v(!1);function o(){return F.reduce((e,i)=>{const d=i.key,te=i.defaultValue;return V(te)?e[d]=te():e[d]=null,e},{})}function D(){x.value=o(),J.value="",n.value=!0}async function $(){x.value=o(),J.value="",await ye()}function G(){n.value=!1}async function ye(){const e=b(h.create,x.value);if(Object.keys(e).length>0){m("Error submitting task!");return}const i=w(x.value);await K.create("work_logs",i).then(d=>{m("Started task successfully!"),ee(),G()}).catch(d=>{O.error("Error creating data",d),m("Error creating data!")})}const U=v(!1),J=v(""),S=v({});Ce(U,(e,i)=>{e||(S.value={})});async function Le(){const e=b(h.update,S.value);if(Object.keys(e).length>0){m("Error submitting task!");return}const i=w(S.value);await K.update("work_logs",S.value.id,i).then(d=>{m("Ended task successfully!"),ee(),We(),J.value==="quick"?$():J.value==="input"&&setTimeout(D,1e3)}).catch(d=>{O.error("Error submitting task",d),m("Error submitting task!")})}async function Y(){S.value=Object.assign({},x.value),await T("startTime",S.value).then(e=>{S.value.startTime=e}),await T("tags",S.value).then(e=>{S.value.tags=e}),S.value.endTime=new Date,U.value=!0}function re(){Y(),J.value="input"}function le(){Y(),J.value="quick"}function We(){S.value={},U.value=!1}const ie=v(!1),Z=f(()=>ie.value?"shortcut show":"shortcut hide");g.registerListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask",invoke:e=>{D()}}),g.registerListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask",invoke:e=>{$()}}),g.registerListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask",invoke:e=>{Y()}}),g.registerListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask",invoke:e=>{re()}}),g.registerListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask",invoke:e=>{le()}}),g.registerListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs",invoke:e=>{n.value&&(n.value=!1),U.value&&(U.value=!1)}}),I.registerListener("loadTodayLogs",{id:"TodayLog",invoke:e=>{ee()}}),I.registerListener("toggleShortcut",{id:"ToggleTodayLogShortcut",invoke:e=>{ie.value=!ie.value}});async function xe(){await K.schemas("work_logs").then(e=>{const i=e.fields;N.value=W(i)}).catch(e=>{m("Error loading schemas!"),O.error("Error loading schemas",e)})}async function ee(){const e={include:k.value,filters:{startTime:{startDate:ne.value,endDate:oe.value}},sort:{field:"startTime",order:"desc"}};await K.list("work_logs",e).then(i=>{j.value=P(i.data),x.value=z(j.value[0]),V(x.value.startTime)&&(a.value=!0)}).catch(i=>{m("Error loading work logs!"),O.error("Error loading work logs",i)})}return we(async()=>{await ee(),await xe()}),(e,i)=>(l(),u("div",Ie,[r("div",Oe,[t(B)?y("",!0):(l(),u("div",{key:0,class:"button",tabindex:"0",onClick:D,onKeydown:E(D,["enter"])},[H(" Start New Task "),r("div",{class:Q(t(Z))}," N ",2)],40,je)),t(B)?y("",!0):(l(),u("div",{key:1,class:"button",tabindex:"0",onClick:$,onKeydown:E($,["enter"])},[H(" Quick Start New Task "),r("div",{class:Q(t(Z))}," Q ",2)],40,Be)),t(B)?(l(),u("div",{key:2,class:"button",tabindex:"0",onClick:Y,onKeydown:E(Y,["enter"])},[H(" End Current Task "),r("div",{class:Q(t(Z))}," E ",2)],40,He)):y("",!0),t(B)?(l(),u("div",{key:3,class:"button",tabindex:"0",onClick:re,onKeydown:E(re,["enter"])},[H(" End and Start New "),r("div",{class:Q(t(Z))}," G ",2)],40,Qe)):y("",!0),t(B)?(l(),u("div",{key:4,class:"button",tabindex:"0",onClick:le,onKeydown:E(le,["enter"])},[H(" End and Quick Start "),r("div",{class:Q(t(Z))}," F ",2)],40,qe)):y("",!0)]),r("div",ze,[r("div",Ue," Today's total: "+C(t(c)(t(X))),1),(l(!0),u(ue,null,de(j.value,(d,te)=>(l(),u("div",{key:te,class:"log"},[Pe,r("div",Ge,[r("div",Je,C(t(M)(d.startTime,t(p).timezone)),1),t(V)(d.endTime)?(l(),u("div",Ye," to "+C(t(M)(d.endTime,t(p).timezone)),1)):y("",!0),t(V)(d.endTime)?(l(),u("div",Ze," ("+C(t(c)(d.duration))+") ",1)):y("",!0),t(L)(d.endTime)?(l(),u("div",Re," (not ended) ")):y("",!0)]),r("div",Xe,C(d.description),1)]))),128))]),ke(me,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=d=>n.value=d),schemas:N.value,"fields-layout":t(A),"data-fields":t(R),data:x.value,fullscreen:!0,"dialog-title":"Start Task",onSubmit:ye},null,8,["modelValue","schemas","fields-layout","data-fields","data"]),ke(me,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=d=>U.value=d),schemas:N.value,"fields-layout":t(A),"data-fields":t(R),data:S.value,fullscreen:!0,"dialog-title":"End Task",onSubmit:Le},null,8,["modelValue","schemas","fields-layout","data-fields","data"])]))}},tt=_e(et,[["__scopeId","data-v-977636d7"]]);const fe=_=>(Se("data-v-139396c0"),_=_(),Ee(),_),at={class:"weekly-tab-container"},st={class:"weekly-tabs"},nt=["onKeydown"],ot=fe(()=>r("i",{class:"fa-solid fa-angle-left"},null,-1)),rt=["onKeydown"],lt=["onKeydown"],it=fe(()=>r("i",{class:"fa-solid fa-angle-right"},null,-1)),ut={class:"weekly-tab-content"},dt={key:0,class:"total"},ct={key:1,class:"total"},vt={class:"timeline"},ft=fe(()=>r("div",{class:"divider"},null,-1)),yt={class:"heading"},kt={class:"date"},mt={key:0,class:"duration"},gt={key:1,class:"duration"},_t={class:"entries"},Tt={key:0},pt={class:"description"},ht={class:"duration"},bt={__name:"WeekLog",props:{loadData:{type:Boolean,default:!1}},setup(_){const L=Te(),K=pe().getSystemConfigs(),{formatLongDate:q}=De(),{formatDuration:p,calculateDuration:M}=ve(),{flashMessage:F}=he(),A=ce(),h=be(),c=v("this"),s=v({}),k=v(0),W=v("prevWeekTab"),b=v("thisWeekTab"),T=v("nextWeekTab"),w=f(()=>{const n=new Date,a=new Date,o=k.value*7;return c.value==="prev"?(a.setDate(a.getDate()+o),a.setDate(a.getDate()-n.getDay())):(c.value==="next"&&a.setDate(a.getDate()+o),a.setDate(a.getDate()-n.getDay())),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a}),m=f(()=>{const n=new Date;return n.setDate(w.value.getDate()+6),n.setHours(23),n.setMinutes(59),n.setSeconds(59),n}),I=f(()=>Array.from(Array(7)).map((n,a)=>{const o=new Date(w.value);return o.setDate(w.value.getDate()+a),o.setHours(0),o.setMinutes(0),o.setSeconds(0),o})),g=f(()=>({startTime:{startDate:w.value,endDate:m.value}})),O=f(()=>Object.entries(s.value).reduce((n,[a,{total:o}])=>n+o,0));function N(n){return s.value[n]?s.value[n]:{total:0,entries:[]}}function R(n){const a=I.value.reduce((o,D)=>(o[D]={entries:[],total:0},o),{});return n.forEach(o=>{const D=new Date(o.startTime),$=new Date(D.getFullYear(),D.getMonth(),D.getDate(),0,0,0),G=M(o);a[$].entries.push(Object.assign({},o,{duration:G})),a[$].total=a[$].total+G}),a}A.registerListener("loadWeeklyLogs",{id:"WeekLog",invoke:n=>{z()}});const x=f(()=>c.value==="prev"?"weekly-tab active":"weekly-tab"),ne=f(()=>c.value==="this"?"weekly-tab active":"weekly-tab"),oe=f(()=>c.value==="next"?"weekly-tab active":"weekly-tab");async function j(){k.value=k.value-1,c.value="prev",W.value.blur(),await z()}async function B(){k.value=0,c.value="this",b.value.blur(),await z()}async function X(){k.value=k.value+1,c.value="next",T.value.blur(),await z()}function P(n){n==="prev"?W.value.focus():n==="next"?T.value.focus():b.value.focus()}async function z(){const n={filters:g.value};await L.list("work_logs",n).then(a=>{s.value=R(a.data)}).catch(a=>{F("Error loading work logs!"),h.error("Error loading work logs",a)})}return we(async()=>{await z()}),(n,a)=>(l(),u("div",at,[r("div",st,[r("div",{ref_key:"prevWeekTab",ref:W,class:Q(t(x)),tabindex:"0",onClick:j,onKeydown:[E(j,["enter"]),a[0]||(a[0]=E(o=>P("this"),["arrow-right"]))]},[ot,H(" Prev Week ")],42,nt),r("div",{ref_key:"thisWeekTab",ref:b,class:Q(t(ne)),tabindex:"0",onClick:B,onKeydown:[E(B,["enter"]),a[1]||(a[1]=E(o=>P("prev"),["arrow-left"])),a[2]||(a[2]=E(o=>P("next"),["arrow-right"]))]}," This Week ",42,rt),r("div",{ref_key:"nextWeekTab",ref:T,class:Q(t(oe)),tabindex:"0",onClick:X,onKeydown:[E(X,["enter"]),a[3]||(a[3]=E(o=>P("this"),["arrow-left"]))]},[H(" Next Week "),it],42,lt)]),r("div",ut,[t(O)>0?(l(),u("div",dt," Week's total: "+C(t(p)(t(O))),1)):y("",!0),t(O)===0?(l(),u("div",ct," Week's total: 0 h 0 m 0 s ")):y("",!0),r("div",vt,[(l(!0),u(ue,null,de(t(I),(o,D)=>(l(),u("div",{key:D,class:"day"},[ft,r("div",yt,[r("div",kt,C(t(q)(o,t(K).timezone)),1),N(o).total>0?(l(),u("div",mt," ("+C(t(p)(N(o).total))+") ",1)):y("",!0),N(o).total===0?(l(),u("div",gt," (0 h 0 m 0 s) ")):y("",!0)]),r("div",_t,[N(o).entries.length===0?(l(),u("div",Tt," No entry ")):y("",!0),(l(!0),u(ue,null,de(N(o).entries,($,G)=>(l(),u("div",{key:G,class:"entry"},[r("div",pt,C($.description),1),r("div",ht,C(t(p)($.duration)),1)]))),128))])]))),128))])])]))}},wt=_e(bt,[["__scopeId","data-v-139396c0"]]),$t={__name:"WorkLogs",setup(_){const L=ce(),{dataFields:V,fieldsLayout:K,filters:q,validations:p,formatDuration:M,calculateDuration:F}=ve(),A={oneline:!0,showHeader:!1,highlightField:"description"},h=v(0),c=[{label:"Today",onchange:s},{label:"Weekly",onchange:k},{label:"All Logs",onchange:W}];function s(){L.emitEvent("loadTodayLogs",{})}function k(){L.emitEvent("loadWeeklyLogs",{})}function W(){L.emitEvent("loadData",{dataType:"Work Logs"})}async function b(T){await c[T].onchange(),h.value=T}return(T,w)=>(l(),ae(Ve,{tabs:c,"selected-tab":h.value,onTabChange:b},{"tab-0":se(()=>[h.value===0?(l(),ae(tt,{key:0})):y("",!0)]),"tab-1":se(()=>[h.value===1?(l(),ae(wt,{key:0})):y("",!0)]),"tab-2":se(()=>[h.value===2?(l(),ae(Ke,{key:0,"model-class":"work_logs","data-type":"Work Logs",fullscreen:!0,"fields-layout":t(K),"data-fields":t(V),validations:t(p),filters:t(q),"table-style":A},{["data-col.startTime"]:se(({row:m})=>[H(" Total duration "),r("strong",null,C(t(M)(t(F)(m))),1)]),_:2},1032,["fields-layout","data-fields","validations","filters"])):y("",!0)]),_:1},8,["selected-tab"]))}};export{$t as default};
