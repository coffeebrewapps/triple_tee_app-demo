import{u as Oe,A as Fe,j as de,c as m,D as he,a8 as je}from"./index-22483805.js";const k=Oe(),{formatDate:De,formatTimestamp:ke}=he(),{isEmpty:y,notEmpty:p}=Fe(),{base64ToFile:q}=je(),w=de();function Ve(d){const u=m(()=>d.reduce((e,t)=>(e[t.key]=t,e),{})),V=m(()=>Object.values(u.value).filter(e=>e.listable)),B=m(()=>V.value.map(e=>e.key)),S=m(()=>Object.values(u.value).filter(e=>e.viewable)),G=m(()=>S.value.map(e=>e.key)),T=m(()=>Object.values(u.value).filter(e=>e.creatable)),Q=m(()=>T.value.map(e=>e.key)),E=m(()=>Object.values(u.value).filter(e=>e.updatable)),R=m(()=>E.value.map(e=>e.key)),P=m(()=>Object.values(u.value).filter(e=>e.sortable)),W=m(()=>P.value.map(e=>e.key)),X=m(()=>Object.values(u.value).some(e=>e.type==="file")),K=m(()=>Object.keys(u.value).filter(e=>L(e))),h=m(()=>Object.keys(u.value).filter(e=>M(e))),Y=m(()=>Object.keys(u.value).filter(e=>j(e))),A=m(()=>Object.keys(u.value).filter(e=>v(e))),I=m(()=>Object.keys(u.value).filter(e=>g(e))),Z=m(()=>Object.keys(u.value).filter(e=>z(e))),_=m(()=>Object.keys(u.value).filter(e=>J(e))),x=m(()=>Object.keys(u.value).filter(e=>D(e))),C=m(()=>Object.keys(u.value).filter(e=>N(e))),$=m(()=>Object.keys(u.value).filter(e=>O(e))),ee=m(()=>d.filter(e=>e.reference||e.file)),te=m(()=>ee.value.map(e=>e.key));function c(e){return(u.value[e]||{}).type}function ne(e){return(u.value[e]||{}).label}function ae(e,t,a,n,r){const i=a.find(s=>s===e),l=t[e];if(!y(l))if(p(i)&&!O(e)){const s=t.includes||{},f=[l].flat().filter(b=>!!b).map(b=>{const F=s[e][b];return u.value[e].reference.label(F)});return v(e)?f:f[0]}else return c(e)==="enum"||c(e)==="select"?n.find(f=>f.key===e).options.find(f=>f.value===l).label:c(e)==="datetime"?ke(l,r.timezone):c(e)==="date"?De(l,r.timezone):O(e)?((t.includes||{})[e][l]||{}).rawData:l}function re(e){return c(e)==="text"||c(e)==="number"}function se(e){return c(e)==="textarea"}function v(e){return c(e)==="multiSelect"}function g(e){return c(e)==="singleSelect"}function L(e){return c(e)==="select"||c(e)==="enum"}function j(e){return c(e)==="select"||c(e)==="multiSelect"||c(e)==="singleSelect"||c(e)==="enum"}function M(e){return j(e)&&u.value[e].options&&u.value[e].options.server}function z(e){return u.value[e].nullToggleable}function J(e){return e==="tags"||Object.is(u.value[e].isTags,!0)}function D(e){return c(e)==="object"}function N(e){return c(e)==="number"}function O(e){return c(e)==="file"}function H(e,t,a,n){return Object.assign({},{loading:!1,pagination:{offset:t,limit:a,client:!1}},n)}function ue(e){return d.map(t=>{if(t.type==="enum"){const a=e[t.key].enums,n=Object.keys(a).map(i=>({value:i,label:a[i]}));return Object.assign({},t,{options:n})}else return t})}function le(e,t){return Object.keys(e).reduce((a,n)=>{const i=e[n].map(l=>l(t)).filter(l=>!!l);return i.length>0&&(a[n]=i),a},{})}async function ce(e,t){return k.view(e,t,{})}async function ie(e,t){const a=u.value[e].options,n=a.modelClass,r=t.map(i=>ce(n,i));return new Promise((i,l)=>{Promise.all(r).then(s=>{const o=s.map(f=>{const b=a.value(f),F=a.label(f);return{value:b,label:F}});i(o)}).catch(s=>{w.error("Error loading includes from server",s),l(s)})})}function oe(e,t){const a=t[e];if(p(a))return a;const n=u.value[e].defaultValue;return p(n)?n():a}async function me(e,t){return new Promise((a,n)=>{const r=oe(e,t);if(y(r)){a(r);return}if(D(e)){p(r)?a(JSON.stringify(r,!1,4)):a(r);return}if(O(e)){const l=u.value[e].file;if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const s=t.includes[e][r];q(s.rawData,s.filename,s.mimeType).then(o=>{a(o)}).catch(o=>{n(o)})}else k.view(l.modelClass,r,{}).then(s=>{y(t.includes[e])&&(t.includes[e]={}),t.includes[e][r]=s,q(s.rawData,s.filename,s.mimeType).then(o=>{a(o)}).catch(o=>{n(o)})}).catch(s=>{w.error("Error formatting data for show",s),a(r)});return}if(c(e)!=="date"&&c(e)!=="datetime"&&!v(e)&&!g(e)){a(r);return}if(c(e)==="date"||c(e)==="datetime"){let l;r instanceof Date||typeof r=="string"?l=new Date(r):l=Object.entries(r).reduce((s,[o,f])=>(p(f)?s[o]=new Date(f):s[o]=f,s),{}),a(l);return}const i=[r].flat();if((g(e)||v(e))&&Array.isArray(u.value[e].options)){const l=u.value[e].options,s=i.map(o=>{const f=l.find(b=>b.value===o);return{value:f.value,label:f.label}});a(s);return}if(p(t.includes)&&p(t.includes[e])&&Object.keys(t.includes[e]).length>0){const l=t.includes[e],s=i.map(o=>{const f=l[o],b=u.value[e].options,F=b.value(f),ye=b.label(f);return{value:F,label:ye}});a(s)}else ie(e,i).then(l=>{a(l)}).catch(l=>{w.error("Error formatting data for show",l);const s=[];i.forEach(o=>{p(o)&&s.push({value:o,label:o})}),a(s)})})}function fe(e){const t=Object.assign({},e);return A.value.forEach(n=>{const r=t[n]||[];t[n]=r.map(i=>i.value)}),I.value.forEach(n=>{const r=t[n]||[];t[n]=(r[0]||{}).value}),K.value.forEach(n=>{const r=t[n];(y(r)||r.length===0)&&(t[n]=null)}),x.value.forEach(n=>{p(t[n])&&t[n].length>0&&(t[n]=JSON.parse(t[n]))}),C.value.forEach(n=>{p(t[n])&&(t[n]=parseFloat(t[n]))}),Object.entries(t).reduce((n,[r,i])=>(Object.is(i,void 0)?n[r]=null:n[r]=i,n),{})}function pe(e){return Object.entries(e).reduce((t,[a,n])=>(t[a]=n.map(r=>({name:r,params:{}})),t),{})}function be(e={}){return Object.entries(e).reduce((t,[a,n])=>(p(n)&&n!==""&&(g(a)&&n.length>0?t[a]=n[0].value:v(a)&&n.length>0?t[a]=n.map(r=>r.value):t[a]=n),t),{})}function ve(e={}){return Object.entries(e).reduce((t,[a,n])=>(p(n)&&n!==""&&(g(a)&&n.length>0?t[a]=n[0].value:v(a)&&n.length>0?t[a]=n.map(r=>r.value):c(a)==="date"?(p(n.startDate)&&(t[a]={},t[a].startDate=n.startDate),p(n.endDate)&&(y(t[a])&&(t[a]={}),t[a].endDate=n.endDate)):c(a)==="datetime"?(p(n.startTime)&&(t[a]={},t[a].startTime=n.startTime),p(n.endTime)&&(y(t[a])&&(t[a]={}),t[a].endTime=n.endTime)):t[a]=n),t),{})}async function U(e,t){const a=u.value[e].options||{};if(a.server){const n=a.limit||5;return new Promise((r,i)=>{k.list(a.modelClass,{offset:t,limit:n}).then(l=>{const s=l.data,f={total:l.total,data:s.map(b=>({value:a.value(b),label:a.label(b)}))};r(H(e,t,n,f))})})}else return new Promise((n,r)=>{n(Object.assign({},{data:a,total:a.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ge(){return new Promise((e,t)=>{Promise.all(h.value.map(a=>{const n=u.value[a].offset||0;return U(a,n)})).then(a=>{const n={};a.forEach((r,i)=>{const l=h.value[i];n[l]=r}),e(n)}).catch(a=>{t(a)})})}return{schemasMap:u,listableFields:V,listableKeys:B,viewableFields:S,viewableKeys:G,creatableFields:T,creatableKeys:Q,updatableFields:E,updatableKeys:R,sortableFields:P,sortableKeys:W,multipartData:X,clientOptionsFields:K,clientOptionsField:L,serverOptionsFields:h,serverOptionsField:M,selectableKeys:Y,multiSelectableFields:A,singleSelectableFields:I,inputType:c,inputLabel:ne,inputValue:ae,inputableField:re,multiInputableField:se,multiSelectableField:v,singleSelectableField:g,selectableField:j,nullToggleableField:z,nullToggleableFields:Z,tagsField:J,tagsFields:_,objectField:D,objectFields:x,numberField:N,numberFields:C,fileField:O,fileFields:$,includeKeys:te,formatInputOptionsData:H,formatDataFields:ue,formatDataForShow:me,formatDataForSave:fe,formatErrorsForDisplay:pe,formatFiltersForShow:be,formatFiltersForLoad:ve,validateParams:le,fetchOptions:U,initOptionsData:ge}}export{Ve as u};
